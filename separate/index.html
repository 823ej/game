<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Midnight Detective RPG</title>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="utility-dock">
    <div id="game-info" class="utility-pill">Lv.1 | 💰 0원</div>
    <div class="utility-buttons">
        <button class="small-btn" onclick="openInventory()">🎒 인벤토리</button>
        <button class="small-btn" onclick="saveGame()">💾 저장</button>
        <button class="small-btn" onclick="loadGame()">📂 로드</button>
    </div>
</div>

<div class="container">

    <div id="inventory-overlay" class="inventory-overlay hidden" onclick="closeInventory()">
        <div class="inventory-panel" onclick="event.stopPropagation()">
            <div class="inventory-header">
                <div class="inventory-title">🎒 가방 (<span id="inv-count">0</span>/6)</div>
                <button class="small-btn" onclick="closeInventory()">닫기</button>
            </div>
            <div class="inventory-body">
                <div class="item-list" id="inventory-list"></div>
            </div>
        </div>
    </div>

    <div id="hub-scene" class="scene hidden hub-scene">
        <div class="hub-illustration"></div>
        <div class="hub-overlay-gradient"></div>

        <div class="hub-content">
            <div class="hub-hero">
                <div class="hub-copy">
                    <p class="hub-tag">MIDNIGHT OFFICE</p>
                    <h1>🕵️ 미드나잇 탐정 사무소</h1>
                    <p class="hub-sub">도시의 어둠을 밝히는 유일한 불빛</p>
                </div>
            </div>

            <div class="hub-actions">
                <div class="hub-grid">
                    <button class="hub-card" onclick="openCaseFiles()">
                        <div class="hub-card-title">📁 사건 파일 (출동)</div>
                        <div class="hub-card-desc">의뢰를 선택하고 현장으로 나갑니다.</div>
                    </button>
                    <button class="hub-card" onclick="renderCityMap()">
                        <div class="hub-card-title">🗺️ 도시로 외출</div>
                        <div class="hub-card-desc">사건 현장이나 상점으로 이동합니다.</div>
                    </button>
                    <button class="hub-card" onclick="hubRest()">
                        <div class="hub-card-title">☕ 커피 한 잔 (회복)</div>
                        <div class="hub-card-desc">체력과 이성을 회복합니다. (500원)</div>
                    </button>
                    <button class="hub-card" onclick="renderShopScreen('shop_internet')">
                        <div class="hub-card-title">📦 인터넷 주문 (상점)</div>
                        <div class="hub-card-desc">장비를 구매합니다.</div>
                    </button>
                    <button class="hub-card" onclick="openDeckManager()">
                        <div class="hub-card-title">🃏 덱 정비 (카드)</div>
                        <div class="hub-card-desc">전투용/대화용 덱을 편집합니다.</div>
                    </button>
                    <button class="hub-card" onclick="saveGame()">
                        <div class="hub-card-title">💾 업무 일지 (저장)</div>
                        <div class="hub-card-desc">현재 상태를 기록합니다.</div>
                    </button>
                </div>
            </div>
        </div>
    </div>
<div id="deck-scene" class="scene hidden" style="background:#222;">
    <div style="padding:10px; background:#333; box-shadow:0 2px 5px rgba(0,0,0,0.5); display:flex; justify-content:space-between; align-items:center;">
        <h2 style="margin:0; color:#eee;">🃏 덱 관리</h2>
        <div>
            <button id="tab-battle" class="small-btn" style="background:#e74c3c; font-weight:bold;" onclick="switchDeckMode('battle')">⚔️ 전투 덱</button>
            <button id="tab-social" class="small-btn" style="background:#8e44ad; font-weight:bold; opacity:0.5;" onclick="switchDeckMode('social')">💬 소셜 덱</button>
        </div>
        <button class="small-btn" onclick="renderHub()">❌ 닫기</button>
    </div>

    <div class="deck-builder-container">
        <div class="deck-column">
            <div class="deck-header">
                <h3>장착 중 (<span id="deck-count">0</span>)</h3>
                <span style="font-size:0.8em; color:#aaa;">전투에 가져갈 카드입니다.</span>
            </div>
            <div id="active-deck-list" class="card-grid"></div>
        </div>

        <div style="display:flex; align-items:center; color:#555; font-size:2em;">⇄</div>

        <div class="deck-column" style="background:#2c3e50;">
            <div class="deck-header">
                <h3>보관함 (<span id="storage-count">0</span>)</h3>
                <span style="font-size:0.8em; color:#aaa;">대기 중인 카드입니다.</span>
            </div>
            <div id="storage-list" class="card-grid"></div>
        </div>
    </div>
</div>

<div id="city-scene" class="scene hidden" style="background:#111; align-items:center;">
    <h2 style="color:#f1c40f; margin-bottom:10px;">🌃 나이트 시티 지도</h2>
    <p style="color:#777; margin-bottom:20px;">이동할 구역을 선택하세요.</p>
    
    <div id="district-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; width:100%; max-width:700px; padding:10px;">
        </div>

    <button class="action-btn" style="margin-top:20px; background:#7f8c8d;" onclick="renderHub()">🏠 사무소 복귀</button>
</div>

<div id="exploration-scene" class="scene hidden">
    <div class="scenario-header">
        <h2 id="scenario-title" style="color:#3498db; margin:0;">시나리오 제목</h2>
        <div class="progress-container">
            <div class="prog-label">🕵️ 단서 (진척도)</div>
            <div class="prog-bar-bg"><div id="clue-bar" class="prog-bar-fill" style="width:0%; background:#2ecc71;"></div></div>
            <div class="prog-label">⚠️ 위협도 (Doom)</div>
            <div class="prog-bar-bg"><div id="doom-bar" class="prog-bar-fill" style="width:0%; background:#e74c3c;"></div></div>
        </div>
    </div>

    <div class="location-view">
        <img id="loc-img" src="https://placehold.co/600x300/111/444?text=Night+City" alt="Location">
        <div id="loc-desc" class="loc-text">
            당신은 어두운 뒷골목에 서 있습니다.<br>
            네온사인이 깜빡거리고, 어디선가 사이렌 소리가 들립니다.
        </div>
    </div>

<div class="action-grid">
    <button class="action-btn" onclick="exploreAction('investigate')">🔍 조사하기</button>
    <button class="action-btn" onclick="exploreAction('move')">👣 장소 이동</button>
    <button class="action-btn" onclick="exploreAction('rest')">☕ 잠깐 쉬기</button>
    
    <button id="btn-retreat" class="action-btn" style="background:#7f8c8d;" onclick="confirmRetreat()">🏠 복귀 (중단)</button>
</div>

</div>

    <div id="battle-scene" class="scene hidden">
        <div class="battle-area">
            <div class="character" id="player-char">
                    <h3 style="margin:2px 0; font-size:1em;">👤 플레이어</h3>
                    <img id="p-img" src="https://placehold.co/150x150/3498db/ffffff?text=Hero" alt="Player" class="char-img" style="width:100px; height:100px;"> 
                    <div class="hp-bar-bg"><div class="hp-bar-fill" id="p-hp-bar"></div></div>
                    <div style="font-size:0.9em;">HP: <span id="p-hp">25</span>/<span id="p-max-hp">25</span> <span class="block-icon">🛡️<span id="p-block">0</span></span></div>
                    <div class="stats" id="p-stats" style="font-size:0.8em;">공1 방1 속1</div>
                    <div class="buffs" id="p-buffs" style="min-height:20px;"></div>
                    <div style="margin-top: 5px; display: flex; justify-content: center; gap: 3px;">
                        <button id="btn-draw-pile" class="small-btn" style="font-size:0.7em;" onclick="openPileView('draw')">덱(0)</button>
                        <button id="btn-discard-pile" class="small-btn" style="font-size:0.7em;" onclick="openPileView('discard')">버림(0)</button>
                        <button id="btn-exhaust-pile" class="small-btn" style="font-size:0.7em;" onclick="openPileView('exhaust')">소멸(0)</button>
                    </div>
                </div>

            <div id="enemies-area" class="enemies-wrapper"></div>
        </div>

        <div class="control-group">
            <div class="status-panel">
                <div id="turn-info" style="word-break: keep-all;">게임 시작</div>
            </div>
            
            <div class="log-area" id="log-box"></div>
            
            <button id="end-turn-btn" class="action-btn btn-end-turn-side" onclick="endPlayerTurn()">
                턴<br>종료
            </button>
        </div>

    <div class="hand-area" id="hand-container"></div>
</div>

    <div id="event-scene" class="scene hidden">
        <div class="event-content" id="event-content-box"></div>
    </div>
</div>

<div id="result-scene" class="scene hidden" style="background:#111; justify-content:center; align-items:center;">
    <div style="text-align:center; animation: fadeIn 1s;">
        <h1 style="color:#f1c40f; font-size:3em; margin-bottom:10px; text-shadow:0 0 10px #f1c40f;">MISSION COMPLETE</h1>
        <p style="color:#aaa; margin-bottom:40px;">의뢰를 성공적으로 완수했습니다.</p>
        
        <div style="background:#222; padding:30px; border-radius:10px; border:1px solid #444; width:300px; margin:0 auto; text-align:left;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span>💰 의뢰비:</span> <span id="res-gold" style="color:#f1c40f; font-weight:bold;">0 G</span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span>✨ 경험치:</span> <span id="res-xp" style="color:#3498db; font-weight:bold;">0 XP</span>
            </div>
            <div style="display:flex; justify-content:space-between;">
                <span>🎁 특별 보상:</span> <span id="res-item" style="color:#2ecc71;">없음</span>
            </div>
        </div>

        <button class="action-btn" style="margin-top:40px; width:200px;" onclick="returnToHub()">🏠 사무소로 복귀</button>
    </div>
</div>

<div id="story-scene" class="scene hidden" style="background:#000; position:relative; overflow:hidden;">
        <div id="story-bg" style="position:absolute; top:0; left:0; width:100%; height:100%; background-size:cover; background-position:center; opacity:0.5;"></div>
        
        <div id="story-standing" style="position:absolute; bottom:0; width:100%; height:100%; display:flex; justify-content:center; align-items:flex-end; pointer-events:none;">
            </div>

        <div class="dialog-container" onclick="nextDialog()">
            <div id="story-name" class="name-tag">이름</div>
            <div id="story-text" class="dialog-text">대사가 출력됩니다.</div>
            <div class="next-icon">▼</div>
        </div>

        <div id="story-choice-overlay" style="display:none;">
        </div>
</div>

<div id="popup-layer">
    <div class="popup-box" onclick="event.stopPropagation()">
        <h2 id="popup-title" style="color:#f1c40f;">제목</h2>
        <div id="popup-desc" style="font-size:1.1em; color:#ddd; margin:10px 0;">내용</div>
        <div id="popup-content"></div>
        <div class="popup-btns" id="popup-buttons"></div>
    </div>
</div>

    <script src="data.js"></script>
    <script src="game.js"></script>
    <script src="story.js"></script>
<svg id="drag-layer" style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999; display:none;">
    <path id="drag-path" d="" stroke="#f1c40f" stroke-width="4" fill="none" stroke-dasharray="10,5" stroke-linecap="round" />
    <circle id="drag-head" cx="0" cy="0" r="8" fill="#e74c3c" stroke="#fff" stroke-width="2" />
</svg>
</body>
</html>