:root {
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --battle-char-height: 132px;
}

html,
body {
    height: 100%;
    min-height: 100dvh;
    width: 100%;
}

body {
    font-family: 'Apple SD Gothic Neo', sans-serif;
    background: #ffffff;
    color: #111;
    text-align: center;
    user-select: none;
    margin: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100dvh;
    overscroll-behavior-y: none;
    /* 화면 당겨서 새로고침/주소창 노출 방지 */
    touch-action: pan-x pan-y;
    /* 더블탭 확대 등 불필요한 제스처 방지 */
    -webkit-tap-highlight-color: transparent;
    /* 터치 시 파란색 깜빡임 제거 */
}

.container {
    width: min(1400px, 95vw, calc(100vh * 16 / 9));
    /* 16:9에 가깝게 넓혀서 PC 시인성 개선 */
    flex: 1 1 auto;
    min-height: 0;
    margin: 0 auto;
    padding: clamp(8px, 1.8vw, 16px) clamp(8px, 1.8vw, 16px) calc(var(--safe-bottom) + clamp(8px, 1.8vw, 16px)) clamp(8px, 1.8vw, 16px);
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 8px;
    box-sizing: border-box;
    overflow: visible;
}

.utility-dock {
    position: relative;
    display: flex;
    justify-content: center;
    /* 터치하기 편하게 하단 패딩 약간 추가 */
    padding: calc(var(--safe-top) + 4px) 8px 12px 8px;
    z-index: 260;
    pointer-events: auto;
    background: transparent;
}

#sc-title-mini {
    font-size: 0.75em;
    color: #f1c40f;
    font-weight: bold;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    /* 공간 부족 시 ... 처리 */
    width: 100%;
    text-align: center;
    line-height: 1.2;
}

.mini-bar-group {
    display: flex;
    align-items: center;
    gap: 4px;
    width: 100%;
    height: 6px;
}

.mini-prog-label {
    font-size: 0.6em;
    line-height: 1;
}

.mini-bar-bg {
    flex: 1;
    background: #ffffff;
    height: 100%;
    border-radius: 0;
    border: 1px solid #555;
    position: relative;
}

.mini-bar-fill {
    height: 100%;
    transition: width 0.3s;
}

.utility-dock-inner {
    width: min(1400px, 100%);
    display: flex;
    align-items: center;
    justify-content: space-between;
    /* 양쪽 끝 배분 */
    gap: 8px;
    /* 요소 간 간격 */
    flex-wrap: wrap;
    /* 공간에 맞춰 줄바꿈 허용 */
}

.utility-dock .small-btn {
    pointer-events: auto;
}

/* 1. 캐릭터 정보 (줄어들지 않음) */
#game-info {
    flex-shrink: 0;
    white-space: nowrap;
}

/* 2. 시나리오 정보 (공간에 맞춰 늘어나고 줄어듦) */
.scenario-pill {
    flex: 1;
    /* 남는 공간 차지 */
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid #3c4b5c;
    border-radius: 0;
    padding: 0 10px;
    min-width: 120px;
    /* 최소 폭 보장 */
    max-width: 400px;
    /* 너무 넓어지지 않게 */
    height: 36px;
    pointer-events: auto;
    overflow: hidden;
}

/* 모바일 최적화 (글씨 크기 및 간격 조절) */


.utility-pill {
    background: #ffffff;
    border: 1px solid #333;
    color: #111;
    padding: 0 10px;
    border-radius: 0;
    font-weight: 700;
    font-size: 0.92em;
    box-shadow: none;
    white-space: nowrap;
    pointer-events: auto;
    height: 36px;
    display: inline-flex;
    align-items: center;
}

/* 3. 버튼 그룹 (줄어들지 않음) */
.utility-buttons {
    display: flex;
    gap: 4px;
    flex-wrap: nowrap;
    flex-shrink: 0;
}

/* ?紐껉뭣?醫듼봺 ??살쒔??됱뵠 */
.inventory-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 250;
    padding: 16px;
    overflow: auto;
    /* 큰 콘텐츠가 잘리지 않도록 스크롤 허용 */
}

/* [style.css] 인벤토리 관련 스타일 전면 수정 */

/* 1. 패널 스타일 */
.inventory-panel {
    width: min(600px, 95%);
    height: 500px;
    /* 고정 높이 (스크롤 위해) */
    background: #ffffff;
    border: 2px solid #3a4b5d;
    border-radius: 0;
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.8);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    /* 자식 요소 튀어나옴 방지 */
    padding: 0;
    /* 패딩 제거 (탭이 꽉 차게) */
}

/* 2. 상단 탭 영역 */
.inventory-header-tabs {
    display: flex;
    background: #ffffff;
    border-bottom: 2px solid #3a4b5d;
    height: 50px;
    align-items: stretch;
}

/* 탭 버튼 */
.inv-tab {
    flex: 1;
    /* 공간 등분 */
    background: #ffffff;
    border: none;
    color: #222;
    font-weight: bold;
    font-size: 1em;
    cursor: pointer;
    transition: 0.2s;
    border-right: 1px solid #111;
}

/* 활성화된 탭 */
.inv-tab.active {
    background: #ffffff;
    /* 패널 몸체와 같은 색 */
    color: #f1c40f;
    /* 강조색 */
    border-bottom: 3px solid #f1c40f;
    /* 활성 표시 */
}

/* 닫기 버튼 */
.close-inv-btn {
    width: 50px;
    background: #c0392b;
    color: #222;
    border: none;
    font-size: 1.2em;
    cursor: pointer;
}

/* 3. 몸체 (스크롤 영역) */
.inventory-body {
    flex: 1;
    /* 남은 높이 모두 차지 */
    background: #ffffff;
    padding: 15px;
    overflow-y: auto;
    /* ★ 세로 스크롤 활성화 */
}

/* 4. 아이템 그리드 */
.item-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
    /* 반응형 그리드 */
    gap: 10px;
    justify-items: center;
}

.inventory-panel {
    width: min(880px, 100%);
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    box-shadow: none;
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 14px;
}

.inventory-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}

.inventory-title {
    font-weight: bold;
    color: #f1c40f;
    font-size: 1.1em;
}

.inventory-body {
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    padding: 12px;
    min-height: 120px;
}

.item-list {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.item-icon {
    width: 40px;
    height: 40px;
    border-radius: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.2em;
    cursor: pointer;
    position: relative;
    border: 2px solid #555;
    transition: 0.2s;
}

.item-icon:hover {
    transform: scale(1.1);
    z-index: 5;
}

.item-relic {
    background: #e67e22;
    border-color: #d35400;
    color: #222;
}

.item-consumable {
    background: #27ae60;
    border-color: #2ecc71;
    color: #222;
}

.item-rank-2 {
    box-shadow: 0 0 5px #3498db;
}

.item-rank-3 {
    box-shadow: 0 0 8px #f1c40f;
    border-color: #f1c40f;
}

/* [?怨뺣뼺?] ?熬곣뫗逾???????????瑜곴텕???뺢퀗??????쳜??????*/
.item-actions {
    position: absolute;
    bottom: -35px;
    /* ?熬곣뫗逾???꾩룆?€餓??熬곣뫁??*/
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 5px;
    background: #f5f5f5;
    padding: 3px;
    border-radius: 0;
    border: 1px solid #555;
    z-index: 200;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
}

.item-btn {
    font-size: 0.8em;
    padding: 2px 6px;
    cursor: pointer;
    border: none;
    border-radius: 0;
    color: #222;
}

.btn-confirm {
    background: #27ae60;
}

.btn-cancel {
    background: #c0392b;
}

/* ?熬곣뫗逾??戮곕턄 ??ルㅎ臾??琉??????띠룆踰??*/
.item-icon.selected {
    border-color: #f1c40f;
    box-shadow: 0 0 10px #f1c40f;
    z-index: 150;
}

/* ??袁⑥깓 */
/* [??瑜곸젧] ??袁⑥깓 ?熬곣뫚???곌떠???(?熬곣뫗逾?????섎€꿰춯? */
.tooltip {
    visibility: hidden;
    width: 160px;
    background-color: #ffffff;
    color: #111;
    text-align: center;
    border-radius: 0;
    padding: 10px;

    /* ?熬곣뫚?? ?熬곣뫗逾?袁⑷섭?????섎€꿰춯?*/
    top: 50%;
    left: 120%;
    /* ???섎€꿰춯?쏅윪???뿉??꾩럾????繹?*/
    transform: translateY(-50%);
    /* ??瑜곸땋 繞벿살탳???筌먲퐣議?*/

    /* ?リ옇????熬곣뫚?????㏃뎽 ?貫?껆뵳??*/
    bottom: auto;
    margin-left: 0;

    position: absolute;
    z-index: 9999;
    /* 嶺뚣끉裕뉑묾??*/

    font-size: 13px;
    font-weight: normal;
    line-height: 1.4;

    border: 1px solid #111;
    opacity: 0;
    transition: opacity 0.3s;
    box-shadow: none;

    pointer-events: none;
    /* ????????沅?*/
}

/* [?怨뺣뼺?] ??袁⑥깓 ??븐슙?€??(??湲깃국???띠럾??洹먮뿪?€) */
.tooltip::after {
    content: "";
    position: absolute;
    top: 50%;
    right: 100%;
    /* ??袁⑥깓????湲깃국 */
    margin-top: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: transparent #ffffff transparent transparent;
}

/* [?怨뺣뼺?] ?????釉띾쐝? ?熬곣뫗逾???????*/
.item-icon.disabled {
    opacity: 0.6;
    cursor: not-allowed;
    filter: grayscale(80%);
}

.item-icon:hover .tooltip {
    visibility: visible;
    opacity: 1;
}

/* ?縕??Scene) ??㉱€??*/
.scene {
    width: 100%;
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
    position: relative;
    border-radius: 0;
    overflow: hidden;
}

.hidden {
    display: none !important;
}

/* 캐릭터 생성 화면: 모바일에서도 스크롤 가능 + 하단 버튼 접근 보장 */
.char-creation-scene {
    background: #ffffff;
    align-items: flex-start;
    justify-content: flex-start;
    overflow-y: auto;
    overflow-x: hidden;
    padding: clamp(10px, 2vw, 15px);
    /* [MOD] 패딩 축소 */
}

.char-creation-content {
    width: min(1400px, 98%);
    /* [MOD] 너비 대폭 확장 */
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
    text-align: left;
    padding: clamp(10px, 2vw, 15px);
    /* [MOD] 내부 패딩 축소 */
    box-sizing: border-box;
}

/* [ADDED] 캐릭터 생성 분할 레이아웃 */
.char-creation-split {
    display: flex;
    flex-direction: row;
    gap: 14px;
    width: 100%;
    align-items: stretch;
}

.char-col-left,
.char-col-right {
    width: 100%;
}

.char-col-left {
    flex: 0 0 340px;
    max-width: 380px;
    min-width: 280px;
}

.char-col-right {
    flex: 1 1 auto;
    min-width: 0;
}

@media (max-width: 980px) {
    .char-creation-split {
        flex-direction: column;
    }
    .char-col-left,
    .char-col-right {
        width: 100%;
        max-width: none;
        min-width: 0;
    }
}

/* [ADDED] 호버 움직임 강제 제거 클래스 */
.no-hover-move:hover {
    transform: none !important;
    box-shadow: none !important;
    /* 그림자 확대도 제거 원할 시 */
}

/* [ADDED] 모바일 가로 모드 (및 태블릿 등 넓은 화면)에서만 좌우 분할 */


#btn-finish-creation {
    position: sticky;
    bottom: calc(var(--safe-bottom) + 10px);
    width: 100%;
    box-shadow: none;
    z-index: 5;
}



/* [NEW] ????슢???????*/
.deck-builder-container {
    display: flex;
    flex: 1;
    height: 100%;
    overflow: hidden;
    gap: 10px;
    padding: 10px;
}

.deck-column {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: #ffffff;
    border-radius: 0;
    border: 1px solid #111;
    overflow: hidden;
}

.deck-header {
    padding: 10px;
    background: #ffffff;
    border-bottom: 1px solid #111;
}

.deck-header h3 {
    margin: 0;
    color: #f1c40f;
}

.card-grid {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    display: flex;
    flex-wrap: wrap;
    align-content: flex-start;
    gap: 8px;
    justify-content: center;
}

/* ????슢???沃섎챶??燁삳?諭??????*/
.builder-card {
    width: 90px;
    height: 120px;
    background: #ecf0f1;
    color: #333;
    border-radius: 0;
    padding: 5px;
    font-size: 0.75em;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    border: 2px solid #bdc3c7;
    transition: 0.1s;
    position: relative;
}

.builder-card:hover {
    transform: scale(1.01);
    border-color: #f1c40f;
    z-index: 10;
}

.builder-card b {
    font-size: 1.1em;
    display: block;
    margin-top: 5px;
}

.builder-card .cost {
    background: #3498db;
    color: #222;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    text-align: center;
    line-height: 20px;
    font-weight: bold;
    position: absolute;
    top: -8px;
    left: -8px;
}

/* [NEW] 椰꾧퀣????龜?? ??됱뵠?袁⑹뜍 */
.hub-scene {
    background: #ffffff;
    align-items: center;
    justify-content: flex-end;
    padding: clamp(12px, 3vw, 20px);
}

.hub-illustration {
    position: absolute;
    inset: 0;
    background: none;
    filter: none;
}

.hub-overlay-gradient {
    position: absolute;
    inset: 0;
    background: none;
}

.hub-content {
    position: relative;
    width: min(1040px, 100%);
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: clamp(10px, 2vw, 18px);
    align-items: end;
    z-index: 1;
    padding-bottom: clamp(10px, 4vh, 32px);
}

.hub-hero {
    display: flex;
    align-items: flex-end;
}

.hub-copy {
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    padding: clamp(12px, 2vw, 18px);
    text-align: left;
    box-shadow: none;
    backdrop-filter: none;
}

.hub-copy h1 {
    margin: 4px 0 6px;
    font-size: clamp(1.3rem, 3vw, 1.9rem);
    color: #f1c40f;
}

.hub-sub {
    margin: 0;
    color: #333;
    font-size: clamp(0.9rem, 2vw, 1rem);
}

.hub-tag {
    margin: 0;
    letter-spacing: 0.15em;
    font-size: clamp(0.7rem, 1.8vw, 0.85rem);
    color: #333;
}

.hub-actions {
    display: flex;
    justify-content: center;
}

.hub-grid {
    width: 100%;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: clamp(8px, 2vw, 16px);
}

.hub-card {
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    padding: 10px 12px;
    text-align: left;
    color: #111;
    cursor: pointer;
    transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
    box-shadow: none;
    backdrop-filter: none;
    width: 100%;
    outline: none;
}

.hub-card:hover {
    transform: translateY(-2px);
    border-color: #111;
    box-shadow: none;
}

.hub-card-title {
    font-weight: 700;
    margin-bottom: 4px;
    font-size: 0.92rem;
}

.hub-card-desc {
    margin: 0;
    font-size: 0.8rem;
    color: #333;
    line-height: 1.4;
}



/* [NEW] ?癒?텢 ?遺얇늺 ?????*/
.scenario-header {
    background: #ffffff;
    padding: 15px;
    border-radius: 0;
    margin-bottom: 15px;
    border: 1px solid #111;
    box-shadow: none;
}

.progress-container {
    margin-top: 10px;
    text-align: left;
}

.prog-label {
    font-size: 0.8em;
    color: #222;
    margin-bottom: 2px;
    display: flex;
    justify-content: space-between;
}

.prog-bar-bg {
    background: #ffffff;
    height: 10px;
    border-radius: 0;
    margin-bottom: 8px;
    overflow: hidden;
    border: 1px solid #444;
}

.prog-bar-fill {
    height: 100%;
    transition: width 0.5s;
}

.location-view {
    position: relative;
    margin-bottom: 20px;
    border: 2px solid #111;
    border-radius: 0;
    overflow: hidden;
}

#loc-img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    opacity: 0.6;
}

.loc-text {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #ffffff;
    color: #111;
    padding: 15px;
    text-align: left;
    font-size: 1.1em;
    line-height: 1.5;
    border-top: 1px solid #111;
}

.action-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    gap: 10px;
}


/* [수정] 플레이어/적 박스 크기 균형 */
.character {
    width: clamp(120px, 15vw, 170px);
    padding: clamp(8px, 1.5vw, 14px);
    border-radius: 0;
    position: relative;
    z-index: 5;
    transition: 0.2s;
    text-align: center;
    flex: 0 0 auto;
    margin-bottom: 0;
}

/* ????뽮쉐???????あ?귐됱춸 揶쏅벡??*/
.character.turn-active {
    border: 2px solid #f1c40f;
    box-shadow: 0 0 15px rgba(241, 196, 15, 0.3);
    background: rgba(255, 255, 255, 0.05);
    /* ?袁⑼폒 ??? 獄쏄퀗瑗?*/
}

/* [?곕떽?] 筌?Ŧ??????筌왖 ?????*/
.char-img {
    width: clamp(80px, 10vw, 110px);
    height: auto;
    /* 정사각형 강제 해제 (길쭉하게 나옴) */

    /* [추가] 너무 길어져서 UI를 뚫는 것 방지 (최대 높이 제한) */
    max-height: 200px;
    object-fit: contain;
    /* ??쑴???醫???렽???筌?쑴? */
    margin-bottom: 5px;
}

/* [?곕떽?] ?醫딅빍筌롫뗄?????쎈늄??됱뿫 ?類ㅼ벥 */

/* 1. ?⑤벀爰?(??삘뀲筌잛럩?앮에??얇끇?롥첎? 癰귣벀? - ???쟿??곷선?? */
@keyframes atk-p {
    0% {
        transform: translateX(0);
    }

    30% {
        transform: translateX(50px) scale(1.1);
    }

    /* ??롮몵嚥??? */
    100% {
        transform: translateX(0);
    }
}

/* 1-2. ?⑤벀爰?(??긱걹??곗쨮 ?얇끇?롥첎? 癰귣벀? - ?怨몄뒠) */
@keyframes atk-e {
    0% {
        transform: translateX(0);
    }

    30% {
        transform: translateX(-50px) scale(1.1);
    }

    100% {
        transform: translateX(0);
    }
}

/* 2. ??④봄 (??살쨮 獄쎛?紐껊뼄揶쎛 癰귣벀? + ??몿而?甕곕뜆李?? */
@keyframes hit-anim {
    0% {
        transform: translateX(0);
        filter: brightness(1);
    }

    20% {
        transform: translateX(-10px);
        filter: brightness(0.5) sepia(1) hue-rotate(-50deg) saturate(5);
    }

    /* ??몿而뷴칰?*/
    40% {
        transform: translateX(10px);
    }

    /* ??뺣쐷 ??ㅲ뵝 */
    60% {
        transform: translateX(-5px);
    }

    100% {
        transform: translateX(0);
        filter: brightness(1);
    }
}

/* 3. ??쎄텢/甕곌쑵遊?(?袁⑥쨮 ??甕??꾟뫗?? */
@keyframes bounce-double {
    0% {
        transform: translateY(0);
    }

    25% {
        transform: translateY(-20px);
    }

    /* ?癒곕늄 1 */
    50% {
        transform: translateY(0);
    }

    75% {
        transform: translateY(-10px);
    }

    /* ?癒곕늄 2 (?臾롮쓺) */
    100% {
        transform: translateY(0);
    }
}

/* [?곕떽?] ??沃섎챷? ??용뮞???????*/
.damage-number {
    position: absolute;
    top: 10%;
    /* 筌?Ŧ????믩챶??域뱀눘荑?*/
    left: 50%;
    transform: translateX(-50%);
    color: #ff3333;
    /* 揶쏅베?????몿而??*/
    font-size: 2.5em;
    /* ??苡? */
    font-weight: 900;
    /* ?袁⑼폒 ?대벀苡? */
    text-shadow: 2px 2px 0 #000, -1px -1px 0 #000;
    /* 野꺜?? ???あ?귐됱쨮 揶쎛??녾쉐 ?類ｋ궖 */
    z-index: 999;
    pointer-events: none;
    /* 筌띾뜆???????獄쎻뫚鍮?????띿쓺 */
    animation: float-up 0.8s ease-out forwards;
}

/* [?곕떽?] ??ъ쁽揶쎛 ?袁⑥쨮 ???ゅ첎?筌????わ쭪????醫딅빍筌롫뗄???*/
@keyframes float-up {
    0% {
        transform: translate(-50%, 0) scale(0.5);
        opacity: 0;
    }

    20% {
        transform: translate(-50%, -20px) scale(1.2);
        opacity: 1;
    }

    /* ??????援??*/
    100% {
        transform: translate(-50%, -80px) scale(1);
        opacity: 0;
    }

    /* ?袁⑥쨮 ???わ쭪?*/
}

/* ?醫딅빍筌롫뗄????怨몄뒠 ?????(JS?癒?퐣 ?븐늿?????野껉퍔?? */
.anim-atk-p {
    animation: atk-p 0.4s ease-out;
}

.anim-atk-e {
    animation: atk-e 0.4s ease-out;
}

.anim-hit {
    animation: hit-anim 0.4s ease-in-out;
}

.anim-bounce {
    animation: bounce-double 0.6s ease-in-out;
}

.hp-bar-bg {
    background: #f5f5f5;
    height: 12px;
    border-radius: 0;
    margin: 6px 0;
    overflow: hidden;
    border: 1px solid #555;
}

.hp-bar-fill {
    background: #e74c3c;
    height: 100%;
    width: 100%;
    transition: 0.5s;
}

/* [??륁젟] ?紐껊굡 ?怨몃열: 餓κ쑬而?퐛?疫뀀뜆?(nowrap) 獄???살쒔???쨮????됱뒠 */
.hand-area {
    display: flex;
    justify-content: center;
    flex-wrap: nowrap;
    /* [???뼎] 餓κ쑬而?퐛?????*/
    align-items: flex-end;
    /* ?袁⑥삋筌??類ｌ졊 */

    height: 220px;
    /* ?誘れ뵠 ?⑥쥙??(燁삳?諭???밸씜 ?⑤벀而??類ｋ궖) */
    padding: 10px;
    margin-top: 20px;

    overflow: visible;
    /* 燁삳?諭뜹첎? ?袁⑥쨮 ???????????롡봺筌왖 ??꾩쓺 */
    pointer-events: none;
    /* ???⑤벀而?????獄쎻뫗? (燁삳?諭띰쭕??????띿쓺) */
    z-index: 50;
}

.hand-area::-webkit-scrollbar {
    display: none;
    /* Chrome, Safari, Opera */
}

/* [??륁젟] 嚥≪뮄???怨몃열: 揶쎛????獄쏄퀣??*/
.log-area {
    height: 100%;
    flex: 1;
    /* ??? ?⑤벀而?筌△뫁? */
    overflow-y: auto;
    background: #ffffff;
    border: 1px solid #444;
    padding: 5px;
    /* ??ㅻ뎃 餓κ쑴??*/
    text-align: left;
    font-size: 0.85em;
    /* 疫꼲????由???곸? 餓κ쑴??*/
    color: #222;
    border-radius: 0;
    margin: 0;
    /* 筌띾뜆彛???볤탢 */
}

/* [?곕떽?] ?怨밴묶 ??ㅺ섯 (??긱걹: ??AP ?類ｋ궖) */
.status-panel {
    width: 110px;
    /* ?⑥쥙????덊돩 */
    background: #ffffff;
    border: 1px solid #34495e;
    border-radius: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 5px;
    color: #222;
    font-weight: bold;
    text-align: center;
    font-size: 0.9em;
    flex-shrink: 0;
    /* ??由?餓κ쑴堉??? ??놁벉 */
}


/* 燁삳?諭??????*/
.card {
    background: #ffffff;
    color: #111;
    width: 130px;
    height: 185px;
    border-radius: 0;
    padding: 8px;
    cursor: pointer;
    font-size: 0.8em;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    border: 2px solid #bdc3c7;
    transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s, margin 0.2s, border-color 0.2s;
    box-shadow: none;
    position: relative;
    /* [癰궰野? 疫꿸퀡???怨밴묶??野껊??귨쭪? ??꾪?揶쏄쑨爰????*/
    flex-shrink: 0;
    margin: 0 5px;
    /* ?臾믪겳??5px????? */
    transition: all 0.2s ease-out;
    pointer-events: auto;
    transform-origin: bottom center;
}

/* [?곕떽?] 野껊??귝묾?筌뤴뫀諭?(.compact)?????벥 燁삳?諭??????*/
.hand-area.compact .card {
    margin: 0;
    /* 疫꿸퀡??筌띾뜆彛???볤탢 */
    margin-left: -30px;
    /* ??긱걹??곗쨮 野껊??귝묾?*/
}

/* 野껊??귝묾?筌뤴뫀諭??猷?筌?甕곕뜆??燁삳?諭??獄쎛?귐? ??놁벉 */
.hand-area.compact .card:first-child {
    margin-left: 0;
}

/* 筌?甕곕뜆??燁삳?諭????긱걹??곗쨮 獄쎛?귐? ??꾩쓺 */
.card:first-child {
    margin-left: 0;
}

/* [??륁젟] 筌띾뜆?????議????(Hover) */
.card:not(.fan-card):hover {
    transform: translateY(-5px) scale(1.01) !important;
    z-index: 100;
    border-color: #f1c40f;
    box-shadow: none;

    /* ?紐껋쒔 ??뽯퓠??筌뤴뫀諭??怨???곸뵠 ?臾믪겳 ?⑤벀而??類ｋ궖 */
    margin-left: 10px !important;
    margin-right: 10px !important;
}

.card.disabled {
    cursor: not-allowed;
    filter: grayscale(80%) brightness(0.55);
    transform: none;
}

/* disabled 카드는 배경을 불투명하게 덮어서 뒤 카드가 비치지 않게 함 */
.card.disabled::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(180, 180, 180, 0.45);
    border-radius: inherit;
    pointer-events: none;
}

.card-cost {
    background: #3498db;
    color: #ffffff;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    text-align: center;
    line-height: 25px;
    font-weight: bold;
    position: absolute;
    top: -10px;
    left: -10px;
}

.card-name {
    font-weight: bold;
    margin-top: 10px;
    font-size: 1.1em;
}

.card-group-badge {
    font-size: 0.75em;
    color: #7f8c8d;
    font-weight: bold;
    text-align: center;
    margin-top: -2px;
}

.card-desc {
    font-size: 0.8em;
    color: #555;
    line-height: 1.3;
}

/* [?곕떽?] 燁삳?諭??源껎닋(癰? ?????*/
.card-rank {
    position: absolute;
    top: 2px;
    right: 5px;
    color: #f1c40f;
    /* 疫뀀뜆源?*/
    font-weight: bold;
    font-size: 1.2em;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    /* ??癰귣똻?졾칰?域밸챶????곕떽? */
}

/* [?곕떽?] ??륂뒄 癰궰野???揶쏅벡???????*/
.mod-val-buff {
    color: #2ecc71;
    font-weight: bold;
}

/* ??륂뒄 筌앹빓? (?λ뜄以? */
.mod-val-debuff {
    color: #e74c3c;
    font-weight: bold;
}

/* ??륂뒄 揶쏅Ŋ??(??몿而? */
/* [?곕떽?] 筌뤴뫀而??揶쎛嚥?筌뤴뫀諭?揶쏅벡????살쒔??됱뵠 */
#rotate-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #ffffff;
    color: #222;
    z-index: 9999;
    display: none;
    /* ??깅꺖????? */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
}

/* ??源???怨몄젎/??곷뻼) ?袁⑷퍥 ?遺얇늺 ?????*/
#event-scene {
    justify-content: center;
    align-items: center;
    text-align: center;
}

.event-content {
    background: #ffffff;
    padding: 40px;
    border-radius: 0;
    width: 100%;
    max-width: 600px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
    border: 1px solid #34495e;
}

.event-title {
    font-size: 2em;
    margin-bottom: 10px;
    color: #f1c40f;
}

.event-desc {
    font-size: 1.2em;
    margin-bottom: 30px;
    color: #ecf0f1;
}

.shop-items {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 30px;
}

.shop-item {
    cursor: pointer;
    transition: 0.2s;
    position: relative;
}

.shop-item:hover {
    transform: scale(1.01);
}

.shop-item.sold-out {
    opacity: 0.4;
    pointer-events: none;
    filter: grayscale(100%);
}

.shop-item.sold-out::after {
    content: "SOLD OUT";
    position: absolute;
    top: 40%;
    left: 10%;
    color: red;
    font-weight: bold;
    font-size: 1.5em;
    transform: rotate(-15deg);
    border: 2px solid red;
    padding: 5px;
}

.shop-price {
    background: #ffffff;
    color: #f1c40f;
    padding: 5px;
    border-radius: 0;
    margin-top: 5px;
    font-weight: bold;
}

/* 甕곌쑵?됬몴?*/
.action-btn {
    background: #ffffff;
    color: #111;
    border: 1px solid #333;
    padding: clamp(8px, 1.8vh, 11px) clamp(16px, 3vw, 22px);
    font-size: clamp(0.92rem, 2vw, 1rem);
    cursor: pointer;
    border-radius: 0;
    box-shadow: none;
    transition: 0.1s;
}

.action-btn:active {
    transform: translateY(4px);
    box-shadow: none;
}

.action-btn:disabled {
    background: #7f8c8d;
    box-shadow: none;
    cursor: not-allowed;
    transform: none;
}

.small-btn {
    background: #e8e8e8;
    color: #222;
    border: 1px solid #777;
    padding: clamp(3px, 1.2vh, 6px) clamp(6px, 1.6vw, 10px);
    font-size: clamp(0.74rem, 1.8vw, 0.82rem);
    cursor: pointer;
    border-radius: 0;
    margin: 0 2px;
    min-width: 42px;
}











/* ??밸씜 */
#popup-layer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.05);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1200;
}

.popup-box {
    background: #f0f0f0;
    padding: 30px;
    border-radius: 0;
    width: min(420px, 62vw);
    max-width: calc(100% - 380px);
    max-height: 80%;
    display: flex;
    flex-direction: column;
    text-align: center;
    border: 1px solid #555;
}

.popup-btns {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    gap: 10px;
}

.pile-list {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    padding: 10px;
    background: #f5f5f5;
    border-radius: 0;
    margin-top: 10px;
}

.mini-card {
    width: 70px;
    height: 100px;
    background: #ecf0f1;
    color: #333;
    border-radius: 0;
    padding: 5px;
    font-size: 0.6em;
    display: flex;
    flex-direction: column;
    justify-content: center;
    text-align: center;
    border: 1px solid #bdc3c7;
}

.mini-card b {
    display: block;
    font-size: 1.2em;
    margin-bottom: 3px;
}

.keyword {
    position: relative;
    color: #f1c40f;
    font-weight: bold;
    cursor: help;
    text-decoration: underline dotted;
}

.keyword .tip-text {
    visibility: hidden;
    width: 180px;
    background-color: #111;
    color: #222;
    text-align: center;
    border-radius: 0;
    padding: 8px;
    position: absolute;
    z-index: 1000;
    bottom: 125%;
    left: 50%;
    margin-left: -90px;
    font-size: 0.8em;
    font-weight: normal;
    border: 1px solid #777;
    opacity: 0;
    transition: opacity 0.2s;
    pointer-events: none;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
    white-space: normal;
    line-height: 1.4;
}

.keyword:hover .tip-text {
    visibility: visible;
    opacity: 1;
}


/* --- ??쎈꽅???뚮９??(Visual Novel) --- */
#story-scene {
    --story-padding: clamp(12px, 3vw, 48px);
    --dialog-height: clamp(140px, 22vh, 200px);
    --stage-max-height: max(240px, calc(100dvh - var(--safe-top) - var(--safe-bottom) - var(--dialog-height) - var(--story-padding)));
    --stage-max-width: calc(var(--stage-max-height) * 16 / 9);
    width: 100vw;
    height: 100dvh;
    min-height: 100dvh;
    position: fixed !important;
    /* ?ëªƒì”ª??position ??ë¼???™????ì” ï§žÂ€ ï§¤ì’–ê¸???¨ì¢Ž??*/
    inset: 0;
    z-index: 300;
    /* ??»â…¨ UI?? ??¹ë¾½ ?ê¾¨ì¤ˆ ?????ï§¤ì’–ê¸??¥ë¿‰???ê³—í…§ */
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: center;
    padding: calc(var(--safe-top) + var(--story-padding)) max(var(--story-padding), calc((100vw - var(--stage-max-width)) / 2)) calc(var(--safe-bottom) + var(--story-padding)) max(var(--story-padding), calc((100vw - var(--stage-max-width)) / 2));
    box-sizing: border-box;
    overflow: hidden;
}

/* 揶쎛嚥≪뮄? ?蹂? ??띻펾?癒?퐣??餓λ쵐釉??類ｌ졊???얜?? ?醫? */
#story-bg {
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    max-width: none;
    max-height: none;
    transform: none;
    background-size: cover;
    background-position: center;
}

#story-standing {
    left: 50%;
    transform: translateX(-50%);
    max-width: 1600px;
    width: min(1400px, calc(100vw - clamp(24px, 6vw, 120px)), var(--stage-max-width));
    max-height: var(--stage-max-height);
}

/* 筌?Ŧ??????筌왖 */
.story-char {
    height: 90%;
    /* ?遺얇늺 ?誘れ뵠??90% */
    max-width: 400px;
    max-height: var(--stage-max-height);
    object-fit: contain;
    transition: 0.3s;
    filter: brightness(0.5);
    /* 筌?????????紐쇔칰?*/
    transform: scale(0.95);
    position: absolute;
    bottom: 0;
}

.story-char.speaking {
    filter: brightness(1);
    transform: scale(1);
    z-index: 10;
}

.pos-left {
    left: -50px;
}

.pos-right {
    right: -50px;
}

.pos-center {
    left: 50%;
    transform: translateX(-50%) scale(0.95);
}

.pos-center.speaking {
    transform: translateX(-50%) scale(1);
}

/* ???遺욧갯 */
.dialog-container {
    position: absolute;
    bottom: clamp(12px, 4vh, 36px);
    left: 50%;
    right: auto;
    width: min(1200px, 90vw, var(--stage-max-width));
    height: clamp(140px, 22vh, 200px);
    transform: translateX(-50%);
    background: #fff;
    border: 2px solid #fff;
    border-radius: 0;
    padding: clamp(16px, 2.5vw, 24px);
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    cursor: pointer;
    z-index: 100;
    text-align: left;
}

.name-tag {
    background: #e67e22;
    color: #222;
    padding: 5px 15px;
    border-radius: 0;
    font-weight: bold;
    font-size: 1.1em;
    position: absolute;
    top: -15px;
    left: clamp(14px, 2vw, 24px);
    border: 2px solid #fff;
}

.dialog-text {
    color: #222;
    font-size: 1.1em;
    line-height: 1.6;
    margin-top: 10px;
    white-space: pre-wrap;
}







.timeline-container {
    position: absolute !important;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    /* 수직 중앙 정렬 */
    width: auto;
    height: auto;
    gap: 5px;
    z-index: 10;
}

.timeline-node {
    position: relative;

    /* [★핵심] 스케일링: 화면 높이(vh)에 비례하여 크기 자동 조절 */
    /* 최소 25px ~ 최대 45px 사이에서 유동적으로 변함 */
    width: clamp(25px, 9vh, 45px);
    height: clamp(25px, 9vh, 45px);

    margin: 0;
    flex-shrink: 0;
    border-radius: 50%;
    border: 2px solid #555;
    background: #ffffff;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);

    /* 등장 애니메이션용 초기값 */
    opacity: 0;
}

/* [연결선] 세로 배치에 어울리는 짧은 선 */
.timeline-node:not(:last-child)::after {
    content: "";
    position: absolute;
    top: 100%;
    /* 아이콘 바로 아래 */
    left: 50%;
    transform: translateX(-50%);
    width: 2px;

    /* 선 길이도 화면 높이에 따라 조절 */
    height: clamp(2px, 1vh, 5px);

    background: rgba(255, 255, 255, 0.3);
    z-index: -1;
}

.timeline-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    display: block;
}

/* 아군/적군 테두리 색상 */
.timeline-node.node-player {
    border-color: #3498db;
}

.timeline-node.node-enemy {
    border-color: #e74c3c;
}

/* 등장 애니메이션 키프레임 */
@keyframes fadeInNode {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* 데스크톱에서 왼쪽 사이드 공간 확보 (타임라인/유틸 겹침 방지) */





.next-icon {
    position: absolute;
    bottom: 10px;
    right: 15px;
    color: #f1c40f;
    animation: blink 1s infinite;
}

@keyframes blink {
    50% {
        opacity: 0;
    }
}

/* ?醫뤾문筌왖 ?遺얇늺 */
#story-choice-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.05);
    z-index: 200;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 15px;
}

.story-choice-btn {
    background: #ffffff;
    color: #222;
    border: 1px solid #7f8c8d;
    padding: 15px 30px;
    font-size: 1.1em;
    border-radius: 0;
    cursor: pointer;
    width: 80%;
    max-width: 400px;
    transition: 0.2s;
}

.story-choice-btn:hover {
    background: #e67e22;
    border-color: #222;
    transform: scale(1.05);
}

/* 일반 등장 애니메이션 (크기 1배) */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px) scale(1);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* 현재 턴 강조 등장 애니메이션 (크기 1.2배) */
@keyframes fadeInScale {
    from {
        opacity: 0;
        transform: translateY(-10px) scale(1.2);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1.2);
    }
}

/* 4. 애니메이션 정의 */

/* 적 등장 (바닥에서 솟아오름) */
@keyframes popUp {
    0% {
        transform: translateY(100%) scale(0.5);
        opacity: 0;
    }

    60% {
        transform: translateY(-10px) scale(1.1);
        opacity: 1;
    }

    100% {
        transform: translateY(0) scale(1);
        opacity: 1;
    }
}

/* 걷기 (통통 튐) */
@keyframes walkBob {
    0% {
        transform: translateY(0);
    }

    25% {
        transform: translateY(-5px);
    }

    50% {
        transform: translateY(0);
    }

    75% {
        transform: translateY(-3px);
    }

    100% {
        transform: translateY(0);
    }
}

/* 배경 줌인 효과 (이동 시) */
@keyframes bgZoom {
    0% {
        transform: scale(1);
    }

    50% {
        transform: scale(1.1);
    }

    100% {
        transform: scale(1);
    }
}

.anim-popup {
    animation: popUp 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

.anim-walk {
    animation: walkBob 0.6s ease-in-out infinite;
}

.anim-bg-move {
    animation: bgZoom 1s ease-in-out;
}

/* [style.css] 통합 스테이지 스타일 (기존 exploration-stage 대체) */

/* 1. 스테이지 뷰 (컨테이너) */
.stage-view {
    position: relative;
    width: 100%;
    height: 340px;
    background-color: #ffffff;
    overflow: hidden;
    border-radius: 0;
    border: 1px solid #333;
    margin-bottom: 20px;
    display: block;
}

/* 2. 레이어 공통 정의 */
.parallax-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-repeat: repeat-x;
    /* 가로 반복 */
    background-size: auto 100%;
    /* 높이는 꽉 채움 */
    transition: transform 0.1s linear;
    /* 부드러운 이동 */
    pointer-events: none;
}

/* 3. 각 레이어 설정 */
/* 뒷 배경 (원경) */
#layer-bg {
    z-index: 1;
    opacity: 0.6;
    background-image: url('https://placehold.co/3000x340/2c3e50/ffffff?text=Long+Background+Layer+(Scrolled)&font=roboto');
}

/* 캐릭터 레이어 (중경) */
#layer-char {
    position: relative;
    display: flex;
    align-items: flex-end;
    /* 기존 justify-content: center 제거 -> 요소들을 중앙으로 모으되 gap으로 제어 */
    justify-content: space-between;
    width: 100%;
    height: 100%;
    /* [핵심 2] 좌우 UI(타임라인, 덱 버튼)와 겹치지 않게 안쪽으로 밀어넣기 */
    /* 15% 정도 주면 적절히 중앙 쪽으로 오면서 서로 멀어집니다. */
    padding-left: 15%;
    padding-right: 15%;
    padding-bottom: 20px;

    /* 패딩이 너비에 포함되도록 설정 (레이아웃 깨짐 방지) */
    box-sizing: border-box;

    /* 요소 간 최소 간격 유지 */
    gap: 20px;
}

/* 앞 배경 (전경 - 풀숲, 기둥 등) */
#layer-fg {
    z-index: 10;
    /* 경로를 assets 폴더 안의 파일로 변경 */
    background-image: url('assets/전경_풀숲.png');

    opacity: 1.0;
    /* 이미지가 잘 보이도록 투명도 조절 (필요시 0.8 등으로 유지) */
    background-color: transparent;

    /* 이미지 크기 설정 (중요) */
    /* 가로로 긴 이미지라면 높이를 100%로 맞추고 가로는 비율 유지 */
    background-size: auto 100%;
}

/* 4. 캐릭터 위치 보정 */
/* 기존 .character 스타일이 flex width %로 되어 있어서 수정 필요 */
#dungeon-player {
    /* [수정] 너비를 조금 줄이거나, 높이를 기준으로 맞춤 */
    height: var(--battle-char-height);
    /* [수정] 너비를 조금 줄이거나, 높이를 기준으로 맞춤 */

    /* 스테이지 높이(340px)에 맞춰 적당한 높이 고정 */
    width: auto;
    /* 높이에 맞춰 너비 자동 조절 (비율 유지) */

    transition: transform 0.2s;
    /* filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.5)); REMOVED for skewed shadow */
    pointer-events: none;
    /* filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.5)); REMOVED for skewed shadow */
    pointer-events: none;
    /* 클릭은 뒤의 상호작용 오브젝트가 받도록 */
    /* 클릭은 뒤의 상호작용 오브젝트가 받도록 */
}



/* [style.css] 플레이어 배치 영역 수정 (자신에게 버프 걸 때 필요) */
#dungeon-player-wrapper {
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;

    /* ★ 핵심 수정 */
    position: relative;
    z-index: 20;
    /* 시각적으로 오브젝트 위에 있지만 */
    pointer-events: none;
    /* 탐색 시 캐릭터 뒤 오브젝트 클릭 가능하도록 클릭 통과 */
}



#assistant-wrapper {
    position: absolute;
    left: 100%;
    margin-left: 24px;
    bottom: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    pointer-events: none;
}

#assistant-player {
    height: var(--battle-char-height);
    width: auto;
    transition: transform 0.2s;
    /* filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.5)); REMOVED */
    /* filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.5)); REMOVED */
    pointer-events: none;
}

#assistant-shadow {
    height: var(--battle-char-height);
    width: auto;
}

/* 걷는 모션 (좌우 반전 등) */
.walking-right #dungeon-player {
    transform: scaleX(1);
}

.walking-left #dungeon-player {
    transform: scaleX(-1);
}

/* 5. 이동 컨트롤러 (하단) */
.move-controls {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: -60px;
    /* 스테이지 위로 살짝 겹치게 */
    position: relative;
    z-index: 20;
}

.move-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.03);
    border: 3px solid #fff;
    font-size: 2em;
    color: #222;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    transition: transform 0.1s;
}

/* [NEW] 캐릭터 그림자 (Skewed Shadow) */
.char-shadow {
    position: absolute;
    bottom: 8px;
    /* 발보다 조금 아래 -> 위로 올림 */
    left: 0;
    /* width: 100% 이므로 left:0으로 부모와 일치시킴 */
    width: 100%;
    /* 높이도 부모에 맞추되, 원본 비율 유지가 관건 */

    /* 그림자 변형의 핵심 */
    transform-origin: bottom center;
    /* 세로 1/8 축소 (0.125), 좌측으로 눕힘 (각도 30 -> 50deg로 증가) */
    transform: skewX(50deg) scaleY(0.125);

    /* 완전 검은색 + 투명도 (0.4로 복귀) */
    filter: brightness(0) opacity(0.4);

    /* 렌더링 품질 개선 시도 */
    /* 렌더링 품질 개선 시도 */
    image-rendering: auto;

    /* 클릭 통과 */
    z-index: -1;
    /* 캐릭터 뒤로 */
}

/* [NEW] 그림자 애니메이션 동기화 */
/* 1. 플레이어가 왼쪽을 보고 있을 때 (flip) */
/* [NEW] 그림자 애니메이션 동기화 */
/* 1. 플레이어가 왼쪽을 보고 있을 때 (flip) */
/* class 'facing-left'는 #dungeon-player 엘리먼트에 직접 붙음. 형제 선택자(~) 사용 */
#dungeon-player.facing-left~.char-shadow,
#dungeon-player.walking-left~.char-shadow {
    /* [FIX] left:0으로 변경했으므로 translateX 불필요. 
       - scaleX(-1)로 반전하고, skew 방향만 반대로(-50deg) 잡아주면 됨 */
    transform: skewX(-50deg) scaleY(0.125) scaleX(-1);
}

/* 2. 플레이어가 통통 튈 때 (anim-walk) */
/* [FIX] 형제 선택자 대신 일반 선택자 사용하여 DOM 구조와 무관하게 동작 */
#dungeon-player.anim-walk~.char-shadow,
#assistant-player.anim-walk~#assistant-shadow {
    animation: shadowBob 0.6s ease-in-out infinite;
}

@keyframes shadowBob {

    /* [FIX] 캐릭터가 위로 뛸 때 그림자는 땅에 가까워짐 (bottom값 감소) */
    0%,
    50%,
    100% {
        bottom: 8px;
        /* 캐릭터가 아래에 있을 때 그림자는 아래 */
    }

    25%,
    75% {
        bottom: 12px;
        /* 캐릭터가 위로 뛸 때 그림자도 함께 위로 */
    }
}

/* 적 캐릭터 그림자 */
.enemy-unit .char-shadow {
    width: auto;
    height: 100px;
    /* .char-img max-height와 유사하게 설정 필요 */
    max-height: 100%;
}

.move-btn:active {
    transform: scale(0.95);
    background: #e67e22;
}

/* [style.css] 미니맵 높이 대응 */
.minimap-grid {
    /* 기존 gap: 0px 유지 */
    display: grid;
    gap: 0px;
    justify-content: center;
    padding: 20px;
    background: #f5f5f5;
    /* 내용물에 맞게 크기 자동 조절 */
    width: fit-content;
    margin: 0 auto;
    overflow: visible;
}

/* 도시 내부 전용 전체 화면 지도 */
#minimap-overlay.city-minimap-full .inventory-panel {
    width: 95vw !important;
    height: 90vh !important;
    max-width: 95vw !important;
    max-height: 90vh !important;
}

.minimap-grid.city-minimap-grid {
    gap: 8px;
    padding: 40px;
}

.minimap-grid.city-minimap-grid .map-cell {
    width: 90px;
    height: 90px;
    font-size: 1.6em;
}

.minimap-grid.city-minimap-grid .map-cell.city-cell .map-cell-label {
    font-size: 0.55em;
    max-width: 140px;
}

/* 미니맵 팝업 창 크기 유동적으로 */
#minimap-overlay .inventory-panel {
    height: auto !important;
    max-height: 80vh;
    /* 화면 넘어가지 않게 */
    overflow-y: auto;
}

/* 상시 미니맵 (우상단) */
#minimap-toggle-wrapper {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 120;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 6px;
    pointer-events: none;
    /* 내부 버튼/패널만 이벤트 받음 */
}

#btn-minimap {
    pointer-events: auto;
}

.mini-map {
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid #444;
    border-radius: 0;
    padding: 8px;
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.5);
    min-width: 200px;
    pointer-events: auto;
}

.mini-map-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
    color: #f1c40f;
    font-weight: bold;
}

.minimap-grid.mini {
    grid-auto-rows: 22px;
    gap: 4px;
}

.minimap-grid.mini .map-cell {
    width: 22px;
    height: 22px;
    border-width: 1px;
    font-size: 0.85em;
}

.minimap-grid.mini .map-cell.current::after {
    font-size: 0.9em;
}

.map-cell {
    width: 50px;
    height: 50px;
    background-color: #333;
    /* 방 내부 색 */
    /* border-radius: 0; */
    /* 기본적으로 4면 모두 벽(선)이 있음 */
    border: 2px solid #888;

    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2em;
    color: #222;
    position: relative;
    box-sizing: border-box;
    /* 테두리 포함 크기 계산 (중요) */
    overflow: visible;
}

.map-cell.city-cell {
    text-align: center;
    line-height: 1.1;
}

.map-cell.city-cell .map-cell-icon {
    font-size: 1em;
}

.map-cell.city-cell .map-cell-label {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-top: 2px;
    font-size: 0.4em;
    color: #e6e6e6;
    max-width: 90%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    background: rgba(0, 0, 0, 0.05);
    padding: 1px 4px;
    border-radius: 0;
    z-index: 2;
}

.minimap-grid.mini .map-cell.city-cell .map-cell-label {
    font-size: 0.3em;
}

/* 2. 벽 구역 (Wall Cell) - 빗금 패턴 */
.map-cell.wall-cell {
    background-color: #111;
    border-color: #222;
    /* 빗금 패턴으로 '갈 수 없음' 표시 */
    background-image: linear-gradient(45deg, #222 25%, transparent 25%, transparent 50%, #222 50%, #222 75%, transparent 75%, transparent);
    background-size: 10px 10px;
    opacity: 0.5;
}

/* 3. 뚫린 통로 (Path) - 테두리 색을 방 배경색과 동일하게 변경하여 '지움' */
/* z-index를 높여서 옆방의 벽을 덮을 수도 있지만, grid gap 0이므로 색상만 맞춰도 연결되어 보임 */

.map-cell.path-n {
    border-top-color: #333;
}

/* 위쪽 뚫림 */
.map-cell.path-s {
    border-bottom-color: #333;
}

/* 아래쪽 뚫림 */
.map-cell.path-e {
    border-right-color: #333;
}

/* 오른쪽 뚫림 */
.map-cell.path-w {
    border-left-color: #333;
}

/* 왼쪽 뚫림 */

/* 4. 현재 위치 */
.map-cell.current {
    background-color: #555;
    color: #222;
    /* box-shadow: 0 0 15px rgba(241, 196, 15, 0.3); */

}


.map-cell.current::after {
    content: "🧍";
    font-size: 1.2em;

    inset: 0;
    /* box-shadow: inset 0 0 15px rgba(241, 196, 15, 0.5); 노란 광원 효과 */
    pointer-events: none;
}

.map-cell.visited {
    background: #e8e8e8;
    color: #222;
}

.map-cell.boss {
    color: #e74c3c;
    font-weight: bold;
}

.map-cell.start {
    color: #2ecc71;
}

.map-cell.shop {
    color: #f1c40f;
}

.map-cell.path-u {
    border-top: 2px solid #aaa;
}

.map-cell.path-d {
    border-bottom: 2px solid #aaa;
}

.map-cell.path-l {
    border-left: 2px solid #aaa;
}

.map-cell.path-r {
    border-right: 2px solid #aaa;
}

.map-cell.fog {
    background: transparent;
    border-color: transparent;
    opacity: 0;
    pointer-events: none;
}

/* 3-A. 전투 레이어 (탐사/전투 공용 무대 위에 얹힘) */
#battle-layer {
    position: relative;
    z-index: 5;
    width: 100%;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 20px;
}

#battle-layer #player-char {
    flex: 0 0 35%;
}

#battle-layer #enemies-area {
    flex: 1;
    display: flex;
    justify-content: flex-end;
    gap: 15px;
}

/* 3. 전투 화면 요소 위치 보정 */
/* 기존 battle-area 대신 stage-view를 쓰면서 내부 요소 정렬 */
/* [기존 수정] 적 유닛 배치 정렬을 좀 더 안정적으로 고정 */
/* 2. 적 등장 구역 스타일 보정 (오른쪽 배치) */
#dungeon-enemies {
    flex: 0 0 auto;
    display: flex;
    justify-content: flex-start;
    align-items: flex-end;
    gap: 10px;
    padding: 0;
    min-width: 0;

    /* ★ 핵심 수정: position이 있어야 z-index가 먹힙니다 */
    position: relative;
    z-index: 20;
    /* 오브젝트(z:4)보다 확실히 앞으로 */

    /* ★ 핵심 수정: 부모(layer-char)가 none이라도 자식은 클릭 가능해야 함 */
    pointer-events: auto;
}

/* 모바일 대응 (화면이 좁을 때 패딩 조정) */


.pile-buttons {
    position: absolute !important;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    /* 수직 중앙 정렬 */
    display: flex;
    flex-direction: column;
    gap: 5px;
    z-index: 10;
    align-items: flex-end;
}

/* 개별 버튼 스타일 */
.pile-btn {
    pointer-events: auto;
    /* 버튼은 클릭 가능해야 함 */
    padding: 4px 8px;
    font-size: 0.75em;

    /* 반투명 배경으로 무대 가림 최소화 */
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid #555;
    color: #222;
    backdrop-filter: blur(2px);
    border-radius: 0;

    /* 텍스트 줄바꿈 방지 */
    white-space: nowrap;
}

/* 버튼 묶음 (버림/소멸)도 세로로 자연스럽게 연결 */
.pile-btn-stack {
    display: flex;
    flex-direction: column;
    gap: 5px;
    align-items: flex-end;
}

/* [반응형] 모바일 등 작은 화면에서 위치/크기 미세 조정 */


/* [추가] 탐색 모드일 때 적 유닛의 상세 정보(HP바, 아이콘 등) 숨기기 */
.enemies-wrapper.preview-mode .hp-bar-bg,
.enemies-wrapper.preview-mode .status-effects,
.enemies-wrapper.preview-mode .block-icon,
.enemies-wrapper.preview-mode .intent-icon {
    opacity: 0;
    transition: opacity 0.5s;
    /* 부드럽게 사라짐/나타남 */
    visibility: hidden;
    /* 공간은 차지하되 보이지 않음 (위치 고정) */
}

/* 전투 모드로 전환되면 다시 보임 */
.enemies-wrapper .hp-bar-bg,
.enemies-wrapper .status-effects,
.enemies-wrapper .block-icon,
.enemies-wrapper .intent-icon {
    opacity: 1;
    visibility: visible;
    transition: opacity 0.5s;
}

.intent-icon .intent-dmg {
    font-size: 0.7em;
    margin-left: 2px;
}

/* 상태 텍스트 공통 (툴팁 호버 허용) */
.status-effects {
    pointer-events: auto;
}

/* [game menu] */
:root {
    --menu-bg: #f7f7f7;
    --menu-panel: #ffffff;
    --menu-border: #111111;
    --menu-accent: #f1c40f;
    --menu-text: #111111;
    --menu-muted: #555555;
    --menu-danger: #e74c3c;
}

.game-menu-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.03);
    backdrop-filter: blur(6px);
    z-index: 999;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

.game-menu-overlay.hidden {
    display: none;
}

.game-menu-panel {
    width: 100vw;
    height: 100vh;
    background: #ffffff;
    border: 1px solid var(--menu-border);
    border-radius: 0;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.45);
    padding: 24px 28px 28px;
    font-family: "Georgia", "Times New Roman", serif;
    color: var(--menu-text);
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.game-menu-panel>* {
    position: relative;
    z-index: 1;
}

.game-menu-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
}

.game-menu-title {
    font-size: 1.4em;
    letter-spacing: 0.18em;
    color: var(--menu-accent);
}

.game-menu-nav-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
}

.game-menu-footer {
    position: absolute;
    right: 24px;
    bottom: 36px;
    display: flex;
    gap: 8px;
}

.game-menu-body {
    min-height: 320px;
    flex: 1;
}

.game-menu-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 12px;
}

.menu-home-vertical {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 420px;
}

.menu-home-vertical .menu-tile {
    display: flex;
    align-items: center;
    gap: 14px;
}

.menu-home-vertical .menu-tile-icon {
    margin-bottom: 0;
}

.menu-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 14px;
    flex-wrap: wrap;
}

.menu-tab {
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid rgba(80, 100, 130, 0.35);
    border-radius: 0;
    padding: 6px 10px;
    color: var(--menu-text);
    font-size: 0.8em;
    text-transform: uppercase;
    letter-spacing: 0.08em;
}

.menu-tab.active {
    border-color: rgba(241, 196, 15, 0.7);
    color: var(--menu-accent);
}

.menu-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.menu-split {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
}

.menu-pane {
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid rgba(80, 100, 130, 0.35);
    border-radius: 0;
    padding: 12px;
    min-height: 260px;
}

.menu-card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
}

.menu-card {
    background: linear-gradient(160deg, rgba(24, 34, 48, 0.9), rgba(14, 20, 32, 0.9));
    border: 1px solid rgba(90, 120, 160, 0.35);
    border-radius: 0;
    padding: 10px 12px 12px;
    min-height: 140px;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.menu-card-title {
    font-weight: bold;
    font-size: 0.95em;
}

.menu-card-desc {
    font-size: 0.75em;
    color: var(--menu-muted);
    line-height: 1.4;
}

.menu-card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: auto;
}

.menu-card-tag {
    font-size: 0.7em;
    padding: 4px 6px;
    border-radius: 0;
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid rgba(80, 100, 130, 0.35);
}

.menu-list-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 8px 10px;
    border-radius: 0;
    border: 1px solid rgba(80, 100, 130, 0.35);
    background: rgba(0, 0, 0, 0.03);
}

.menu-list-left {
    display: flex;
    gap: 10px;
    align-items: center;
    min-width: 0;
}

.menu-list-icon {
    font-size: 1.2em;
}

.menu-list-text {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.menu-list-title {
    font-size: 0.9em;
    font-weight: bold;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.menu-list-desc {
    font-size: 0.75em;
    color: var(--menu-muted);
}

.game-menu-content {
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid rgba(80, 100, 130, 0.35);
    border-radius: 0;
    padding: 16px 18px;
    min-height: 320px;
    max-height: calc(100vh - 180px);
    overflow: auto;
    animation: menuSlideIn 0.2s ease;
}

.game-menu-content.hidden,
.game-menu-grid.hidden,
.game-menu-nav-row .hidden,
.game-menu-footer .hidden {
    display: none;
}

.menu-content-title {
    font-size: 1.1em;
    color: var(--menu-accent);
    margin-bottom: 10px;
    letter-spacing: 0.06em;
    animation: menuTitleIn 0.25s ease;
}

.menu-content-shell {
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 16px;
    align-items: start;
}

.menu-content-main {
    min-width: 0;
}

.menu-character-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 6px 4px;
}

.menu-character-btn {
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid rgba(80, 100, 130, 0.35);
    border-radius: 0;
    padding: 8px;
    color: var(--menu-text);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    transition: border-color 0.2s ease, transform 0.2s ease;
}

.menu-character-btn img {
    width: 68px;
    height: 68px;
    object-fit: cover;
    border-radius: 0;
    border: 1px solid rgba(120, 140, 170, 0.45);
}

.menu-character-name {
    font-size: 0.8em;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--menu-muted);
}

.menu-character-btn.active {
    border-color: rgba(241, 196, 15, 0.7);
    transform: translateY(-1px);
}

.menu-character-btn.active .menu-character-name {
    color: var(--menu-accent);
}

.menu-character-btn.disabled {
    opacity: 0.4;
    pointer-events: none;
}



.menu-content-section {
    margin-bottom: 14px;
}

.menu-content-label {
    font-size: 0.8em;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--menu-muted);
    margin-bottom: 6px;
}

.menu-content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
}

.menu-pill {
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid rgba(80, 100, 130, 0.35);
    border-radius: 0;
    padding: 8px 10px;
    font-size: 0.85em;
}

.menu-item-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.menu-item-chip {
    padding: 6px 8px;
    border-radius: 0;
    background: rgba(0, 0, 0, 0.03);
    border: 1px solid rgba(80, 100, 130, 0.35);
    font-size: 0.8em;
}

.menu-action-row {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 10px;
}

@keyframes menuSlideIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes menuTitleIn {
    from {
        opacity: 0;
        transform: translateY(-6px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.menu-tile {
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    padding: 14px 12px 16px;
    text-align: left;
    color: var(--menu-text);
    transition: transform 0.15s ease, border 0.15s ease, box-shadow 0.15s ease;
}

.menu-tile:hover {
    transform: translateY(-2px);
    border-color: #111;
    box-shadow: none;
}

.menu-tile.danger:hover {
    border-color: rgba(231, 76, 60, 0.7);
}

.menu-tile-icon {
    font-size: 1.6em;
    margin-bottom: 6px;
}

.menu-tile-title {
    font-size: 1em;
    font-weight: bold;
    margin-bottom: 4px;
}

.menu-tile-desc {
    font-size: 0.75em;
    color: var(--menu-muted);
}

/* [style.css] 맨 아래에 추가 */

/* 플로팅 AP 인디케이터 */
#ap-indicator {
    /* [수정] 둥둥 떠다니기(absolute) -> 자리 잡기(relative) */
    position: relative;
    bottom: auto;
    left: auto;

    /* 크기 유지 */
    width: 64px;
    height: 64px;

    /* 플렉스 박스 안에서 정렬 */
    flex-shrink: 0;
    /* 찌그러짐 방지 */
    align-self: center;
    /* 세로 중앙 정렬 */
    margin: 0 8px;
    /* 좌우 간격 */

    /* 디자인 (기존 유지) */
    background: rgba(0, 0, 0, 0.03);
    border: 3px solid #3498db;
    border-radius: 50%;

    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;

    box-shadow: none;
    z-index: 10;
    transition: transform 0.2s, border-color 0.2s;
}

/* AP 부족할 때 스타일 (JS에서 클래스 추가 가능) */
#ap-indicator.low-ap {
    border-color: #7f8c8d;
    box-shadow: none;
    opacity: 0.7;
}

/* 모바일 가로 모드 등 화면이 작을 때 자동 크기 조절 */


/* 카드 컬렉션용 그리드 (인벤토리 그리드보다 칸이 큼) */
.card-list-grid {
    display: grid;
    /* 카드가 100px 너비이므로 여유 있게 110px 잡음 */
    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
    gap: 15px;
    justify-items: center;
    padding: 10px;
}

/* 컬렉션 뷰 전용 카드 스타일 (기존 .card 상속하되 클릭 방지 등) */
.collection-card-view {
    /* 기존 card 클래스와 함께 사용됨 */
    position: relative;
    cursor: default;
    /* 클릭해도 아무 일 없음 */
    transform: scale(1) !important;
    /* 호버 확대 효과 제거 (선택사항) */
    margin: 0 !important;
}

.collection-card-view:hover {
    transform: translateY(-5px) scale(1.05) !important;
    /* 살짝만 움직이게 */
    z-index: 10;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
}

/* [style.css] 맨 아래에 추가 */

.event-content.shop-mode,
.event-box.shop-mode,
#event-content-box.shop-mode {
    /* [핵심 1] 레이아웃 크기 고정 */
    max-width: none !important;
    width: 100% !important;

    /* 높이를 화면의 85%로 잡되, 패딩을 포함하여 계산 */
    height: 85dvh !important;
    /* vh 대신 dvh 사용 (모바일 주소창 대응) */
    max-height: 800px !important;

    padding: 20px !important;
    box-sizing: border-box !important;
    /* ★ 필수: 패딩이 높이를 늘리지 않게 함 */

    /* [핵심 2] 플렉스 컬럼 구조 (헤더-본문-푸터 분리) */
    display: flex;
    flex-direction: column;
    min-height: 0;
    /* 자식 스크롤 영역이 줄어들 수 있도록 */
    position: relative;

    /* [핵심 3] 모달 전체 스크롤 방지 (본문만 스크롤 되게) */
    overflow: hidden !important;
    /* 헤더/푸터 고정, 중앙만 스크롤 */
    margin: 0;
}

/* 상단 헤더 (고정) */
.event-box.shop-mode .shop-header-area,
.event-content.shop-mode .shop-header-area {
    flex: 0 0 auto;
    /* 크기 고정 (줄어들지 않음) */
    margin-bottom: 12px;
    border-bottom: 1px solid #444;
    padding-bottom: 10px;
    text-align: left;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    position: sticky;
    top: 0;
    background: rgba(0, 0, 0, 0.03);
    z-index: 6;
}

/* 중앙 물품 영역 (여기가 스크롤됨) */
.event-box.shop-mode .shop-main-area,
.event-content.shop-mode .shop-main-area {
    flex: 1;
    /* 남은 공간을 모두 차지 */
    display: flex;
    gap: 15px;
    align-items: flex-start;

    /* ★ 핵심 4: 내용이 넘치면 이 구역만 스크롤 */
    overflow-y: auto;
    min-height: 0;
    /* 플렉스 내부 스크롤 필수 속성 */
    padding-right: 5px;
    /* 스크롤바 공간 확보 */
    padding-bottom: 12px;
    /* 하단 나가기 버튼 가리지 않도록 여유 */
    width: 100%;
}

/* 하단 버튼 영역 (고정) */
.event-box.shop-mode .shop-footer-area,
.event-content.shop-mode .shop-footer-area {
    flex: 0 0 auto;
    /* 크기 고정 */
    margin-top: 10px;
    display: flex;
    justify-content: flex-end;
    border-top: 1px solid #444;
    padding-top: 10px;
    background: rgba(0, 0, 0, 0.03);
    /* 버튼 가독성 확보 */
    position: sticky;
    bottom: 0;
    z-index: 5;
}

/* 개별 컬럼 스타일 */
.shop-col {
    flex: 1;
    background: rgba(0, 0, 0, 0.05);
    padding: 15px;
    border-radius: 0;
    border: 1px solid #3a4b5d;
    /* min-height를 제거하거나 줄여서 모바일에서 너무 길어지지 않게 조정 */
    min-height: 200px;
    display: flex;
    flex-direction: column;
}

.shop-sec-title {
    margin: 0 0 15px 0;
    color: #222;
    font-size: 1.1em;
    border-bottom: 2px solid #555;
    padding-bottom: 5px;
    text-align: left;
}

/* 아이템 그리드 */
.shop-items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    align-items: stretch;
    width: 100%;
}

.shop-item {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* 서비스(기술 망각) 박스 스타일 */
.shop-service-box {
    background: #c0392b;
    border-radius: 0;
    padding: 15px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: 0.2s;
    border: 2px solid transparent;
    width: 100%;
    box-sizing: border-box;
}

.shop-service-box:hover {
    transform: scale(1.01);
    border-color: #f1c40f;
}

.service-icon {
    font-size: 2em;
}

.service-info {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    color: #222;
}

.shop-price-tag {
    background: rgba(0, 0, 0, 0.05);
    padding: 2px 6px;
    border-radius: 0;
    font-size: 0.9em;
    margin-top: 3px;
    color: #f1c40f;
    font-weight: bold;
}

/* 모바일 대응: 세로 배치 시에도 중앙만 스크롤 */



/* [style.css] 맨 아래 수정: 모바일 세로 모드 전용 레이아웃 */



/* --- 스토리 모드 UI 컨트롤 --- */
#story-ui-controls {
    position: fixed;
    /* 절대 위치 고정 */
    top: 20px;
    right: 20px;
    z-index: 9999;
    /* 최상단 */
    display: flex;
    gap: 10px;
}

.story-ui-btn {
    background: rgba(0, 0, 0, 0.05);
    color: #222;
    border: 1px solid rgba(255, 255, 255, 0.5);
    padding: 8px 14px;
    cursor: pointer;
    font-size: 14px;
    border-radius: 0;
    transition: background 0.2s;
}

.story-ui-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.story-ui-btn.active {
    background: #e74c3c;
    border-color: #e74c3c;
    font-weight: bold;
}

/* 로그 오버레이 */
#story-log-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.05);
    z-index: 10000;
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

#story-log-content {
    width: 85%;
    height: 75%;
    background: #ffffff;
    border: 1px solid #555;
    overflow-y: auto;
    color: #222;
    padding: 20px;
    border-radius: 0;
    font-family: sans-serif;
    text-align: left;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
}

#story-log-content p {
    margin: 0 0 12px 0;
    line-height: 1.5;
    border-bottom: 1px solid #333;
    padding-bottom: 8px;
    font-size: 0.95em;
}

.log-name {
    color: #f1c40f;
    font-weight: bold;
    margin-right: 8px;
}






/* [style.css] 추가 */

/* [style.css] .room-object 수정 */
.room-objects {
    position: absolute;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 18px;
    align-items: flex-end;
    z-index: 4;
    pointer-events: auto;
    transition: transform 0.1s linear, opacity 0.2s;
}

.room-object {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    pointer-events: auto;
}

/* 아이콘 (이모지 또는 이미지) */
.dungeon-obj-icon {
    font-size: 4em;
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
    animation: none;
}

.room-object .npc-icon {
    width: 48px;
    height: 48px;
    object-fit: contain;
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
}

/* 라벨 (이름) */
.dungeon-obj-label {
    background: rgba(0, 0, 0, 0.05);
    color: #f1c40f;
    padding: 4px 8px;
    border-radius: 0;
    font-size: 0.8em;
    margin-top: 5px;
    border: 1px solid #555;
    opacity: 0.8;
}

/* 둥둥 떠다니는 애니메이션 제거 */

/* 마우스 올렸을 때 강조 */
.room-object:hover .dungeon-obj-icon {
    transform: scale(1.1);
    filter: drop-shadow(0 0 15px #f1c40f);
}

.room-object:hover .dungeon-obj-label {
    opacity: 1;
    border-color: #f1c40f;
}

/* [style.css] 통합 로그창 스타일 추가 */
.bottom-ui-stack {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.shared-log-area {
    display: none;
    /* 위치 및 크기 */
    width: 100%;
    height: 100px;
    /* 높이 고정 (필요 시 조절) */
    box-sizing: border-box;
    margin-bottom: 10px;

    /* 디자인 */
    background: #ffffff;
    border: 1px solid #444;
    border-radius: 0;
    padding: 8px 12px;

    /* 텍스트 */
    text-align: left;
    font-size: 0.9em;
    line-height: 1.5;
    color: #222;

    /* 스크롤 */
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

/* 로그 개별 줄 스타일 */
.shared-log-area div {
    border-bottom: 1px solid #222;
    padding-bottom: 2px;
    margin-bottom: 2px;
    word-break: keep-all;
    /* 단어 단위 줄바꿈 */
}

/* 스크롤바 커스텀 */
.shared-log-area::-webkit-scrollbar {
    width: 6px;
}

.shared-log-area::-webkit-scrollbar-thumb {
    background: #e8e8e8;
    border-radius: 0;
}

.shared-log-area::-webkit-scrollbar-thumb {
    border-radius: 0;
}

.shared-log-area::-webkit-scrollbar-track {
    background: #ffffff;
}

/* [수정] 전투 하단 컨트롤 그룹 (로그창이 빠졌으므로 높이/정렬 조정) */
.control-group {
    height: 70px;
    width: 100%;
    margin-bottom: 5px;
    display: flex;
    justify-content: space-between;
    /* 양쪽 끝으로 벌림 */
    align-items: center;
    padding: 0 10px;
    /* 좌우 여백 */
    box-sizing: border-box;
    background: transparent;
}

/* AP 인디케이터 위치 미세 조정 */
#ap-indicator {
    margin-left: 0px;
}

/* 7. 오른쪽 버튼 그룹 (도망치기 + 턴종료) */
.btn-group-right {
    display: flex;
    align-items: center;
    gap: 8px;
    /* 버튼 사이 간격 */
}

.btn-end-turn-side {
    height: 50px;
    width: 60px;
    font-size: 0.9em;
    border-radius: 0;
    background: #ffffff;
    border: 1px solid #333;
    box-shadow: none;
    color: #111;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    line-height: 1;
    padding: 0;
    cursor: pointer;
}

.btn-end-turn-side:hover {
    background: #f0f0f0;
}

.btn-end-turn-side:active {
    filter: brightness(0.9);
    transform: none;
}

/* 도망치기/특수행동 버튼 (JS로 생성됨) */
#extra-action-btn {
    height: 50px !important;
    width: 60px !important;
    font-size: 0.85em !important;
    border-radius: 0 !important;
    background: #ffffff !important;
    border: 1px solid #333 !important;
    box-shadow: none !important;
    color: #111 !important;
    font-weight: bold !important;
    display: flex;
    align-items: center;
    justify-content: center;
}

#extra-action-btn:hover {
    background: #f0f0f0 !important;
}

/* [style.css] 맨 아래에 추가: 상점 카드 호버 효과 개선 */

/* 1. 상점 아이템 컨테이너: 자체 확대 제거 */
/* 기존의 .shop-item:hover { transform: scale(1.05); }를 덮어씁니다. */
.shop-item:hover {
    transform: none;
    /* 상자 전체가 커지면서 주변을 미는 현상 방지 */
    z-index: 10;
    /* 대신 가려지지 않도록 맨 앞으로 가져옴 */
}

/* 2. 상점 내부의 카드: 호버 시 얌전하게 만들기 */
.shop-item .card:hover {
    /* [핵심] 레이아웃 흔들림의 주범인 마진 변경을 무력화 */
    margin: 0 !important;
    margin-left: 0 !important;
    margin-right: 0 !important;

    /* [핵심] 과한 확대 효과 축소 */
    /* 기존: scale(1.1) + translateY(-5px) -> 수정: scale(0.9) */
    /* (참고: 상점 카드는 기본 크기가 0.85이므로, 0.9면 살짝만 커지는 정도입니다) */
    transform: scale(0.9) !important;

    /* 그림자도 너무 과하지 않게 조절 */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);

    /* 테두리 강조는 유지 */
    border-color: #f1c40f;
}

/* [style.css] 맨 아래에 추가 */

/* 치명타 텍스트 효과 */
.damage-number.crit-text {
    color: #f1c40f !important;
    /* 금색 */
    font-size: 3.5em !important;
    /* 훨씬 크게 */
    text-shadow:
        3px 3px 0 #c0392b,
        -1px -1px 0 #fff,
        0 0 20px rgba(241, 196, 15, 0.8);
    /* 발광 효과 */
    z-index: 1005;
    animation: crit-pop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* 치명타 팝업 애니메이션 */
@keyframes crit-pop {
    0% {
        transform: translate(-50%, 0) scale(0.5) rotate(-10deg);
        opacity: 0;
    }

    40% {
        transform: translate(-50%, -40px) scale(1.5) rotate(5deg);
        opacity: 1;
    }

    80% {
        transform: translate(-50%, -60px) scale(1.2) rotate(0deg);
        opacity: 1;
    }

    100% {
        transform: translate(-50%, -80px) scale(1);
        opacity: 0;
    }
}

/* [style.css] 맨 아래에 추가 */

/* 왼쪽을 보는 상태 (정지 시) */
.facing-left {
    transform: scaleX(-1);
}

/* 왼쪽 걷기 애니메이션 (이동 시) */
@keyframes walkBobLeft {
    0% {
        transform: translateY(0) scaleX(-1);
    }

    25% {
        transform: translateY(-5px) scaleX(-1);
    }

    50% {
        transform: translateY(0) scaleX(-1);
    }

    75% {
        transform: translateY(-3px) scaleX(-1);
    }

    100% {
        transform: translateY(0) scaleX(-1);
    }
}

/* 왼쪽을 보고 있을 때는 왼쪽 걷기 애니메이션 적용 */
.anim-walk.facing-left {
    animation-name: walkBobLeft;
}

/* [style.css] 문 관련 스타일 수정 */

/* 1. 문 컨테이너 (레이아웃 방해 금지) */
#dungeon-doors {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    /* 컨테이너는 클릭 통과 */
    z-index: 4;
}

/* 2. 문(이동 포인트) 공통 스타일 */
.dungeon-door {
    position: absolute;
    bottom: 40px;

    /* [★핵심 수정] 중앙 정렬 기준점 설정 */
    left: 50%;
    /* translateX는 JS에서 계속 덮어쓰므로 여기선 안 써도 되지만, 초기값을 위해 둠 */
    transform: translateX(-50%);

    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    z-index: 15;
    transition: transform 0.1s linear;
    pointer-events: auto;
    /* 문 자체는 클릭 가능해야 함 */
}

/* (이하 아이콘/라벨 스타일은 기존 유지) */
.door-icon {
    font-size: 3.5em;
    filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.8));
    transition: 0.2s;
}

.door-label {
    background: rgba(0, 0, 0, 0.05);
    color: #222;
    padding: 2px 6px;
    border-radius: 0;
    font-size: 0.75em;
    margin-top: 2px;
    border: 1px solid #777;
    white-space: nowrap;
}

/* 마우스 올렸을 때 강조 */
.dungeon-door:hover .door-icon {
    transform: scale(1.1) translateY(-5px);
}

.dungeon-door:hover .door-label {
    border-color: #f1c40f;
    color: #f1c40f;
}

/* 방향별 색상 구분 (선택사항) */
.door-n .door-label {
    border-color: #3498db;
}

/* 북: 파랑 */
.door-s .door-label {
    border-color: #e74c3c;
}

/* 남: 빨강 */
.door-e .door-label {
    border-color: #f1c40f;
}

/* 동: 노랑 */
.door-w .door-label {
    border-color: #9b59b6;
}

/* 서: 보라 */

/* [style.css] 추가 */

/* 브레이크 상태: 노란 테두리 + 흔들림 */
.enemy-unit.broken {
    border-color: #f1c40f !important;
    animation: shake 0.5s infinite;
    /* 계속 흔들려서 위기감 조성 */
}

/* 기절 상태: 회색조 + 기울임 */
.enemy-unit.stunned {
    filter: grayscale(100%) brightness(0.7);
    transform: rotate(-5deg) scale(0.95);
    border-color: #e74c3c !important;
    opacity: 0.8;
}

/* 회복 모션 */
.enemy-unit.recovering {
    animation: bounce-double 0.5s;
    filter: brightness(1.5);
    /* 잠깐 밝아짐 */
}

@keyframes shake {
    0% {
        transform: translateX(0);
    }

    25% {
        transform: translateX(-2px);
    }

    75% {
        transform: translateX(2px);
    }

    100% {
        transform: translateX(0);
    }
}

/* 플레이어 HUD에 속성 아이콘 표시용 */
.player-attr-icon {
    display: inline-block;
    width: 24px;
    height: 24px;
    background: rgba(0, 0, 0, 0.05);
    border-radius: 50%;
    text-align: center;
    line-height: 24px;
    font-size: 16px;
    margin-left: 5px;
    border: 1px solid #777;
}

.city-scene {
    background: #ffffff;
    align-items: stretch;
    padding: 0;
    gap: 0;
}

.city-hybrid-shell {
    display: grid;
    grid-template-columns: minmax(0, 1fr) 360px;
    gap: 18px;
    align-items: stretch;
    width: 100%;
    height: 100%;
    padding: 18px;
    box-sizing: border-box;
}

.city-hybrid-shell.panel-hidden {
    grid-template-columns: minmax(0, 1fr) 0px;
}

.city-detail-panel {
    transition: opacity 0.2s ease, transform 0.2s ease;
}

.city-left-info {
    position: absolute;
    left: 18px;
    top: 18px;
    width: min(280px, 36vw);
    text-align: left;
    background: rgba(255, 255, 255, 0.92);
    border: 1px solid #d0d0d0;
    padding: 10px 12px;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
    z-index: 6;
}

.city-left-title {
    font-size: 0.95em;
    font-weight: 700;
    color: #111;
    margin-bottom: 6px;
}

.city-left-desc {
    font-size: 0.82em;
    color: #222;
    line-height: 1.4;
}

.city-area-detail .city-detail-title,
.city-area-detail .city-detail-desc {
    display: none;
}

.city-dialogue {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin: 10px 0;
    text-align: left;
}

.city-dialogue.hidden {
    display: none;
}

.city-dialogue-log {
    max-height: 220px;
    overflow-y: auto;
    background: #ffffff;
    border: 1px solid #d0d0d0;
    padding: 10px;
    box-shadow: inset 0 0 0 1px #eee;
    font-size: 0.92em;
    line-height: 1.5;
}

.city-dialogue-line {
    margin-bottom: 8px;
}

.city-dialogue-line:last-child {
    margin-bottom: 0;
}

.city-dialogue-line .speaker {
    display: inline-block;
    font-weight: 700;
    color: #222;
    margin-right: 6px;
}

.city-dialogue-line.is-player .speaker {
    color: #2c3e50;
}

.city-dialogue-line .text {
    color: #333;
}

.city-dialogue-choices {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.city-dialogue-choices.hidden {
    display: none;
}

.city-dialogue-choices .action-btn {
    width: 100%;
    text-align: left;
}

.global-log-panel {
    position: fixed;
    right: 14px;
    top: 80px;
    bottom: 16px;
    width: min(340px, 32vw);
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid #d0d0d0;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.18);
    z-index: 240;
    display: flex;
    padding: 10px;
    box-sizing: border-box;
}

.global-log-panel.hidden {
    display: none;
}

.global-log-panel .city-dialogue-log {
    max-height: none;
    height: 100%;
}

.city-case-panel {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin: 10px 0;
    text-align: left;
}

.city-case-panel.hidden {
    display: none;
}

.city-case-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 260px;
    overflow-y: auto;
    padding: 6px;
    border: 1px solid #d0d0d0;
    background: #ffffff;
}

.city-case-item {
    text-align: left;
}

.city-case-item .case-title {
    font-weight: 700;
    margin-bottom: 4px;
}

.city-case-item .case-desc {
    font-size: 0.8em;
    color: #111;
}

.city-case-item .case-note {
    font-size: 0.75em;
    color: #111;
}

.city-case-actions .action-btn {
    width: 100%;
    text-align: center;
}

.city-detail-panel.is-hidden {
    opacity: 0;
    transform: translateX(12px);
    pointer-events: none;
}

.city-map-canvas {
    position: relative;
    min-height: 430px;
    height: 100%;
    width: 100%;
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    overflow: hidden;
    box-shadow: none;
}

.city-map-canvas::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
        linear-gradient(135deg, rgba(0, 0, 0, 0.03) 0%, rgba(0, 0, 0, 0.00) 60%),
        repeating-linear-gradient(0deg, rgba(0,0,0,0.03), rgba(0,0,0,0.03) 1px, transparent 1px, transparent 24px),
        repeating-linear-gradient(90deg, rgba(0,0,0,0.03), rgba(0,0,0,0.03) 1px, transparent 1px, transparent 24px);
    opacity: 1;
    pointer-events: none;
}

.city-map-lines {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0.7;
}

.city-map-lines line {
    stroke: #888;
    stroke-width: 1.6;
    stroke-dasharray: 4 3;
}

.city-map-node-layer {
    position: absolute;
    inset: 0;
}

.city-node {
    position: absolute;
    transform: translate(-50%, -50%);
    background: #ffffff;
    color: #222;
    border: 1px solid #111;
    padding: 10px 12px 8px;
    border-radius: 0;
    box-shadow: 0 12px 20px rgba(0, 0, 0, 0.32);
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
}

.city-node::after {
    content: "";
    position: absolute;
    inset: -5px;
    border: 1px dashed #111;
    opacity: 0.25;
    border-radius: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
}

.city-node-name {
    display: block;
    font-weight: 700;
    font-size: 0.95em;
}

.city-node-sub {
    display: block;
    font-size: 0.75em;
    color: #666;
}

.city-node:hover {
    transform: translate(-50%, -50%) scale(1.03);
    box-shadow: 0 14px 22px rgba(0, 0, 0, 0.45);
}

.city-node.active {
    box-shadow: 0 0 0 2px #111, 0 14px 22px rgba(0, 0, 0, 0.45);
}

.city-node.active::after {
    opacity: 0.6;
}

.tone-safe {
    --accent: #f1c40f;
}

.tone-busy {
    --accent: #1abc9c;
}

.tone-corporate {
    --accent: #3498db;
}

.tone-dark {
    --accent: #c0392b;
}

.tone-calm {
    --accent: #95a5a6;
}

.tone-outskirts {
    --accent: #e67e22;
}

.tone-water {
    --accent: #00b5d8;
}

.tone-neutral {
    --accent: #9b59b6;
}

.city-chip {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 4px 8px;
    border-radius: 0;
    border: 1px solid #111;
    background: #ffffff;
    color: #333;
    font-size: 0.78em;
    margin-bottom: 4px;
}

.city-chip-action {
    cursor: pointer;
    transition: 0.15s;
}

.city-chip-action:hover {
    border-color: #f1c40f;
    color: #f1c40f;
}

.city-chip-action:disabled {
    opacity: 0.45;
    cursor: not-allowed;
}

.city-detail-panel {
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    padding: 14px;
    box-shadow: none;
    display: flex;
    flex-direction: column;
    gap: 8px;
    min-height: 240px;
}

.city-detail-title {
    margin: 0;
    color: #222;
    font-size: 1.1em;
    letter-spacing: 0.01em;
}

.city-detail-desc {
    margin: 2px 0 6px;
    color: #333;
    line-height: 1.5;
}

.city-tags {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}


.city-area-object-layer {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

.city-area-object {
    position: absolute;
    transform: translate(-50%, -50%);
    pointer-events: auto;
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    padding: 6px 9px;
    font-size: 0.8em;
    cursor: pointer;
    box-shadow: 0 10px 16px rgba(0, 0, 0, 0.28);
}

.city-area-object:hover {
    background: #f4f4f4;
    transform: translate(-50%, -50%) scale(1.02);
}

.hub-scene {
    padding: 0;
}

.hub-map {
    background-size: cover;
    background-position: center;
}

.event-shell {
    width: 100%;
    height: 100%;
    display: grid;
    grid-template-columns: minmax(0, 1fr);
    gap: 16px;
    align-items: stretch;
}

.event-shell.shop-mode {
    grid-template-columns: minmax(0, 1fr) min(340px, 32vw);
}

.event-log-panel {
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    box-shadow: none;
    padding: 14px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 8px;
    min-height: 240px;
}

.event-log-panel .city-dialogue-log {
    max-height: none;
}

.city-hybrid-shell .city-detail-panel,
.event-shell .city-detail-panel {
}

.city-detail-panel .city-dialogue {
    flex: 1;
    min-height: 0;
}

.city-detail-panel .city-dialogue-log {
    flex: 1;
    min-height: 0;
    overflow: auto;
    max-height: none;
}

.city-detail-actions .action-btn {
    width: 100%;
}

.city-detail-actions .action-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

.city-detail-actions,
.city-spot-actions {
    margin-top: auto;
}

.city-note {
    font-size: 0.85em;
    color: #7f8c8d;
    margin-top: 6px;
}

.city-area-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    margin-bottom: 6px;
}

.city-back-btn {
    align-self: center;
}





.city-area {
    margin-top: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.city-area-body {
    display: grid;
    grid-template-columns: minmax(0, 1fr) 360px;
    gap: 18px;
}

.city-area-map {
    position: relative;
    min-height: 280px;
    height: 100%;
    width: 100%;
    border: 1px solid #111;
    border-radius: 0;
    background: #ffffff;
    overflow: hidden;
}

.city-area-map::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
        linear-gradient(160deg, rgba(0,0,0,0.04) 0%, rgba(0,0,0,0.0) 55%),
        repeating-linear-gradient(0deg, rgba(0,0,0,0.04), rgba(0,0,0,0.04) 1px, transparent 1px, transparent 26px),
        repeating-linear-gradient(90deg, rgba(0,0,0,0.04), rgba(0,0,0,0.04) 1px, transparent 1px, transparent 26px);
    pointer-events: none;
}

.city-area-lines {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0.6;
}

.city-area-lines line {
    stroke: #888;
    stroke-width: 1.4;
    stroke-dasharray: 3 3;
}

.city-area-node-layer {
    position: absolute;
    inset: 0;
}

.city-area-node {
    position: absolute;
    transform: translate(-50%, -50%);
    background: #ffffff;
    border: 1px solid var(--accent, #4c6b9b);
    color: #222;
    border-radius: 0;
    padding: 8px 10px;
    font-size: 0.85em;
    box-shadow: 0 10px 18px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
}

.city-area-node:hover {
    transform: translate(-50%, -50%) scale(1.04);
    box-shadow: 0 12px 18px rgba(0, 0, 0, 0.4);
}

.city-area-node.active {
    box-shadow: 0 0 0 2px var(--accent, #f1c40f), 0 12px 18px rgba(0, 0, 0, 0.45);
}

.city-area-detail {
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.city-spot-actions {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
}

.city-spot-actions .action-btn {
    width: 100%;
}





#city-area-mode {
    margin-top: 10px;
}

.city-side-wrapper {
    margin-top: 12px;
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.city-side-header {
    display: flex;
    align-items: center;
    gap: 10px;
}

.city-side-controls {
    display: flex;
    gap: 8px;
}

.city-side-lane {
    position: relative;
    height: 140px;
    background: #ffffff;
    border: 1px dashed #111;
    border-radius: 0;
    overflow: hidden;
}

.city-side-buildings {
    position: absolute;
    inset: 0;
}

.city-side-building {
    position: absolute;
    bottom: 20px;
    transform: translateX(-50%);
    text-align: center;
    color: #111;
    font-size: 0.85em;
    cursor: pointer;
    transition: transform 0.2s ease, filter 0.2s ease;
}

.city-side-building .icon {
    font-size: 1.8em;
    display: block;
}

.city-side-building.active {
    filter: drop-shadow(0 0 4px #f1c40f);
    transform: translateX(-50%) scale(1.05);
}

.city-side-player {
    .city-note {
        font-size: 0.85em;
        color: #7f8c8d;
        margin-top: 6px;
    }

    .city-area-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 6px;
    }

    .city-back-btn {
        align-self: center;
    }





    .city-area {
        margin-top: 12px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .city-area-body {
        display: grid;
        grid-template-columns: 1.4fr 1fr;
        gap: 10px;
    }

    .city-area-map {
        position: relative;
        min-height: 280px;
        border: 1px solid #1f2a36;
        border-radius: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.15));
        overflow: hidden;
    }

    .city-area-lines {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        opacity: 0.6;
    }

    .city-area-lines line {
        stroke: #2f3b55;
        stroke-width: 1.4;
        stroke-dasharray: 3 3;
    }

    .city-area-node-layer {
        position: absolute;
        inset: 0;
    }

    .city-area-node {
        position: absolute;
        transform: translate(-50%, -50%);
        background: #ffffff;
        border: 1px solid var(--accent, #4c6b9b);
        color: #222;
        border-radius: 0;
        padding: 8px 10px;
        font-size: 0.85em;
        box-shadow: 0 10px 18px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }

    .city-area-node:hover {
        transform: translate(-50%, -50%) scale(1.04);
        box-shadow: 0 12px 18px rgba(0, 0, 0, 0.4);
    }

    .city-area-node.active {
        box-shadow: 0 0 0 2px var(--accent, #f1c40f), 0 12px 18px rgba(0, 0, 0, 0.45);
    }

    .city-area-detail {
        background: #ffffff;
        border: 1px solid #1f2a36;
        border-radius: 0;
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .city-spot-actions {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
    }

    /* [NEW] 피격 애니메이션 */
    @keyframes shakeRed {
        0% {
            transform: translate(0, 0);
            filter: brightness(1);
        }

        25% {
            transform: translate(-5px, 0);
            filter: brightness(0.5) sepia(1) hue-rotate(-50deg) saturate(5);
        }

        50% {
            transform: translate(5px, 0);
            filter: brightness(0.5) sepia(1) hue-rotate(-50deg) saturate(5);
        }

        75% {
            transform: translate(-5px, 0);
            filter: brightness(0.5) sepia(1) hue-rotate(-50deg) saturate(5);
        }

        100% {
            transform: translate(0, 0);
            filter: brightness(1);
        }
    }

    .anim-hit {
        animation: shakeRed 0.4s ease-out;
    }

    /* [NEW] 상태이상 오버헤드 표시 */
    .status-overhead {
        position: absolute;
        bottom: 100%;
        /* 캐릭터 머리 위 */
        left: 50%;
        transform: translateX(-50%);
        width: max-content;
        max-width: 200px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 2px;
        pointer-events: none;
        z-index: 50;
        margin-bottom: 5px;
        text-shadow: 0 1px 2px #000;
    }

    .status-badge {
        background: rgba(0, 0, 0, 0.05);
        border: 1px solid #777;
        border-radius: 0;
        padding: 2px 4px;
        font-size: 0.75em;
        color: #222;
    }





    #city-area-mode {
        margin-top: 10px;
    }

    .city-side-wrapper {
        margin-top: 12px;
        background: #ffffff;
        border: 1px solid #1f2a36;
        border-radius: 0;
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .city-side-header {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .city-side-controls {
        display: flex;
        gap: 8px;
    }

    .city-side-lane {
        position: relative;
        height: 140px;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.04) 0%, rgba(255, 255, 255, 0.02) 40%, rgba(0, 0, 0, 0.25) 100%);
        border: 1px dashed #2c3e50;
        border-radius: 0;
        overflow: hidden;
    }

    .city-side-buildings {
        position: absolute;
        inset: 0;
    }

    .city-side-building {
        position: absolute;
        bottom: 20px;
        transform: translateX(-50%);
        text-align: center;
        color: #e5ecf6;
        font-size: 0.85em;
        cursor: pointer;
        transition: transform 0.2s ease, filter 0.2s ease;
    }

    .city-side-building .icon {
        font-size: 1.8em;
        display: block;
    }

    .city-side-building.active {
        filter: drop-shadow(0 0 4px #f1c40f);
        transform: translateX(-50%) scale(1.05);
    }

    .city-side-player {
        position: absolute;
        bottom: 10px;
        left: 10%;
        transform: translateX(-50%);
        font-size: 1.6em;
        transition: left 0.2s ease;
    }

    /* [ADDED] Mobile Landscape Optimization */






    /* [Unified Character Creation Styles - Light Theme] */
    div.char-stat-row,
    div.char-trait-item {
        background-color: #fcfcfc !important;
        border-radius: 0 !important;
        border: 1px solid #ddd !important;
        font-size: 0.95em;
        color: #111 !important;
        padding: 10px 12px !important;
        margin-bottom: 8px;
        display: block;
        width: 100%;
        box-sizing: border-box;
        transition: all 0.2s ease;
    }

    div.char-stat-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* Trait Item Specifics */
    div.char-trait-item {
        cursor: pointer;
        position: relative;
    }

    /* [Request] Individual Item Hover - Very Light Gray */
    /* [Request] Individual Item Hover - Visible Light Gray */
    #char-creation-content div.char-trait-item:hover,
    #char-creation-content div.char-stat-row:hover {
        background-color: #ecf0f1 !important;
        /* Slightly more visible gray */
        border-color: #bdc3c7 !important;
        border-radius: 0;
        transform: translateY(-1px);
        cursor: pointer;
    }

    /* [Fixed] Disable any Hover effect on the Panel Container (Nuclear Option) */
    /* Target via ID + Class to guarantee override */
    #char-creation-content div.hub-card.no-hover-move,
    #char-creation-content div.hub-card.no-hover-move:hover {
        transform: none !important;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1) !important;
        /* Static shadow */
        border-color: #222 !important;
        background-color: #222 !important;
        transition: none !important;
        /* Kill transition */
        cursor: default !important;
    }

    div.char-trait-item.selected {
        background-color: #222 !important;
        border: 2px solid #3498db !important;
        box-shadow: 0 0 5px rgba(52, 152, 219, 0.2) !important;
    }

    div.char-trait-item.default {
        opacity: 0.8;
        background-color: #f8f8f8 !important;
        border-style: dashed !important;
    }

    /* Cost Badges */
    .trait-cost {
        font-size: 0.8em;
        padding: 2px 6px;
        border-radius: 0;
        font-weight: bold;
    }

    .trait-cost.neutral {
        background: #eee;
        color: #777;
    }

    .trait-cost.positive {
        /* Gain Points */
        background: #27ae60;
        color: #222;
    }

    .trait-cost.negative {
        /* Spend Points */
        background: #e74c3c;
        color: #222;
    }

    /* Landscape Layout Fixes */


    /* [Request] Disable interaction with dungeon objects during battle */
    .is-battle .room-object,
    .is-battle .dungeon-door {
        pointer-events: none !important;
        cursor: default !important;
        opacity: 0.3 !important;
        filter: grayscale(100%);
    }

    /* Start Screen Styles */
.start-scene {
    display: flex;
    justify-content: center;
    align-items: center;
    background: #ffffff;
}

.start-content {
    text-align: center;
    padding: 40px;
    background: #ffffff;
    border: 1px solid #111;
    border-radius: 0;
    box-shadow: none;
    backdrop-filter: none;
    border-top: 1px solid #111;
    animation: fadeIn 1s ease-out;
}

    .game-title {
        font-size: 3em;
        color: #f1c40f;
        margin-bottom: 5px;
        text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
        letter-spacing: 2px;
    }

.game-subtitle {
    color: #333;
    font-size: 1.2em;
    margin-bottom: 40px;
    font-style: italic;
}

    .start-menu {
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: 250px;
        margin: 0 auto;
    }

    .start-menu .action-btn {
        width: 100%;
        padding: 15px;
        font-size: 1.1em;
        background: #ffffff;
        border: 1px solid #333;
        box-shadow: none;
    }

    .start-menu .action-btn#btn-infinite-mode {
        background: #ffffff;
        border: 1px solid #333;
        box-shadow: none;
    }

    .start-menu .action-btn:hover {
        transform: translateY(-2px);
        filter: brightness(1.1);
    }

    .start-menu .action-btn:active {
        transform: translateY(2px);
        box-shadow: none;
    }

    .version-info {
        margin-top: 30px;
        color: #555;
        font-size: 0.8em;
    }

    /* Infinite Mode Specifics */
.infinite-stage-hud {
    position: absolute;
    top: 10px;
    left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.05);
        padding: 5px 15px;
        border-radius: 0;
        border: 1px solid #f39c12;
    color: #f39c12;
    font-weight: bold;
    z-index: 1000;
}

}
